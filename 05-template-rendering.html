
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Document manufacture for fun and profit">
      
      
        <meta name="author" content="Murray Andrews">
      
      
      
        <link rel="prev" href="04-template-compilation.html">
      
      
        <link rel="next" href="06-jinja-rendering.html">
      
      
      <link rel="icon" href="img/docma-logo/png/docma-icon-light.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Template Rendering - Docma User Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docma-template-rendering" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Docma User Guide" class="md-header__button md-logo" aria-label="Docma User Guide" data-md-component="logo">
      
  <img src="img/docma-logo/svg/docma-icon-mid-2.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docma User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Template Rendering
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Docma User Guide" class="md-nav__button md-logo" aria-label="Docma User Guide" data-md-component="logo">
      
  <img src="img/docma-logo/svg/docma-icon-mid-2.svg" alt="logo">

    </a>
    Docma User Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01-overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02-document-creation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Creation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03-document-templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Templates
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04-template-compilation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template Compilation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Template Rendering
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="05-template-rendering.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Template Rendering
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rendering-for-pdf-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering for PDF Outputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering-for-html-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering for HTML Outputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-parameter-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Parameter Validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-content-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Content Generation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Content Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamic-content-generation-differences-between-pdf-and-html-output" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Content Generation Differences Between PDF and HTML Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-docma" class="md-nav__link">
    <span class="md-ellipsis">
      Scheme: docma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-file" class="md-nav__link">
    <span class="md-ellipsis">
      Scheme: file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-s3" class="md-nav__link">
    <span class="md-ellipsis">
      Scheme: s3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watermarking" class="md-nav__link">
    <span class="md-ellipsis">
      Watermarking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#document-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Document Metadata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batch-rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Rendering
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="06-jinja-rendering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jinja Rendering
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="07-charts-and-graphs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Charts and Graphs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08-data-sources.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Sources
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="09-fonts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fonts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10-installation-and-usage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation and Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="11-extending-docma.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extending Docma
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="12-api.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="13-caveats-and-issues.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caveats and Issues
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="14-credits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="15-release-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rendering-for-pdf-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering for PDF Outputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering-for-html-outputs" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering for HTML Outputs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-parameter-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Parameter Validation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-content-generation" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Content Generation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Content Generation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dynamic-content-generation-differences-between-pdf-and-html-output" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Content Generation Differences Between PDF and HTML Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-docma" class="md-nav__link">
    <span class="md-ellipsis">
      Scheme: docma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-file" class="md-nav__link">
    <span class="md-ellipsis">
      Scheme: file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scheme-s3" class="md-nav__link">
    <span class="md-ellipsis">
      Scheme: s3
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#watermarking" class="md-nav__link">
    <span class="md-ellipsis">
      Watermarking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#document-metadata" class="md-nav__link">
    <span class="md-ellipsis">
      Document Metadata
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#batch-rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Rendering
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="docma-template-rendering">Docma Template Rendering<a class="headerlink" href="#docma-template-rendering" title="Permanent link">&para;</a></h1>
<p>The document rendering phase combines a compiled docma template with run-time
specified parameters and dynamically generated content to produce a final output
document.</p>
<p>The rendering process is slightly different for PDF and HTML outputs.</p>
<h2 id="rendering-for-pdf-outputs">Rendering for PDF Outputs<a class="headerlink" href="#rendering-for-pdf-outputs" title="Permanent link">&para;</a></h2>
<p><img alt="" src="img/render-phase-pdf.svg" /></p>
<p>The main steps in the process for PDF production are:</p>
<ol>
<li>
<p>Marshal the <a href="06-jinja-rendering.html#rendering-parameters">rendering parameters</a>.</p>
</li>
<li>
<p><a href="#docma-parameter-validation">Validate the rendering parameters</a>.</p>
</li>
<li>
<p>Collect the list of documents to be incorporated into the final output PDF.</p>
</li>
<li>
<p><a href="06-jinja-rendering.html#docma-jinja-rendering">Render HTML documents</a> in the component list using
    Jinja to inject the <a href="06-jinja-rendering.html#rendering-parameters">rendering parameters</a>.</p>
</li>
<li>
<p>Convert the HTML documents to PDF using <a href="https://weasyprint.org/">WeasyPrint</a>.
    This process will also generate any <a href="#dynamic-content-generation">dynamic content</a>
    from specifications embedded in the source HTML.</p>
</li>
<li>
<p>Assemble all of the components (generated PDFs and any listed static PDFs)
    into a single PDF document.</p>
</li>
<li>
<p>Add any requested <a href="#watermarking">watermarking or stamping</a> to the document.</p>
</li>
<li>
<p>Jinja render any required metadata specified in the
    <a href="03-document-templates.html#template-configuration-file">template configuration file</a> and add it to
    the PDF.</p>
</li>
<li>
<p>Optionally, compress the PDF using lossless compression. Depending on the
    PDF contents, compression may, or may not, help.</p>
</li>
</ol>
<h2 id="rendering-for-html-outputs">Rendering for HTML Outputs<a class="headerlink" href="#rendering-for-html-outputs" title="Permanent link">&para;</a></h2>
<p><img alt="" src="img/render-phase-html.svg" /></p>
<p>The main steps in the process for HTML production are:</p>
<ol>
<li>
<p>Marshal the <a href="06-jinja-rendering.html#rendering-parameters">rendering parameters</a>.</p>
</li>
<li>
<p><a href="#docma-parameter-validation">Validate the rendering parameters</a>.</p>
</li>
<li>
<p>Collect the list of documents to be incorporated into the final output HTML.</p>
</li>
<li>
<p><a href="06-jinja-rendering.html#docma-jinja-rendering">Render HTML documents</a> in the component list using
    Jinja to inject the <a href="06-jinja-rendering.html#rendering-parameters">rendering parameters</a>.</p>
</li>
<li>
<p>Process <code>&lt;IMG&gt;</code> tags in the HTML to generate and embed any
    <a href="#dynamic-content-generation">dynamic content</a> from specifications embedded
    in the source HTML. Static images may also be embedded.</p>
</li>
<li>
<p>Assemble all of the component HTML documents into a single HTML document.</p>
</li>
<li>
<p>Jinja render any required metadata specified in the
    <a href="03-document-templates.html#template-configuration-file">template configuration file</a> and add it to
    the HTML.</p>
</li>
</ol>
<h2 id="docma-parameter-validation">Docma Parameter Validation<a class="headerlink" href="#docma-parameter-validation" title="Permanent link">&para;</a></h2>
<p>Docma supports the use of <a href="https://json-schema.org">JSON Schema</a> to validate
rendering parameters at run-time. Parameters are validated against a schema
provided in the <code>parameters-&gt;schema</code> key in the 
<a href="03-document-templates.html#template-configuration-file">template configuration file</a> prior to generating
the output document. Failing validation will halt the production process.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Provision, and hence use, of a parameter validation schema is optional, but
highly recommended to reduce the risk of generating an important
document incorrectly or with nonsensical values.</p>
</div>
<p>All of the normal facilities of  <a href="https://json-schema.org">JSON Schema</a> are
available, except for external schema referencing with <code>$ref</code> directives. Like
the <a href="https://json-schema.org/draft/2020-12/draft-bhutton-json-schema-validation-00#rfc.section.7.3">JSON Schema built-in string
formats</a>,
docma provided <a href="06-jinja-rendering.html#docma-format-checkers">format checkers</a> can be used
in a schema specification with the <code>format</code> attribute of string objects</p>
<p>The following sample schema fragment shows how these are used:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
</span><span id="__span-0-2"><span class="nt">properties</span><span class="p">:</span>
</span><span id="__span-0-3"><span class="w">  </span><span class="nt">customer_email</span><span class="p">:</span>
</span><span id="__span-0-4"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-5"><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span><span class="w">  </span><span class="c1"># This is a JSON schema built-in format checker</span>
</span><span id="__span-0-6"><span class="w">  </span><span class="nt">customer_abn</span><span class="p">:</span>
</span><span id="__span-0-7"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-8"><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">au.ABN</span><span class="w">  </span><span class="c1"># This is a docma provided format checker</span>
</span><span id="__span-0-9"><span class="w">  </span><span class="nt">target_consumption</span><span class="p">:</span>
</span><span id="__span-0-10"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
</span><span id="__span-0-11"><span class="w">    </span><span class="nt">minimum</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-0-12"><span class="w">  </span><span class="nt">consumption_unit</span><span class="p">:</span>
</span><span id="__span-0-13"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-14"><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">energy_unit</span><span class="w">  </span><span class="c1"># This is a docma provided format checker</span>
</span><span id="__span-0-15"><span class="w">  </span><span class="nt">start_date</span><span class="p">:</span>
</span><span id="__span-0-16"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-0-17"><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">date.dmy</span><span class="w">  </span><span class="c1"># This is a docma provided format checker</span>
</span></code></pre></div>
<p>See also <a href="06-jinja-rendering.html#docma-format-checkers">Docma Format Checkers</a>.</p>
<h2 id="dynamic-content-generation">Dynamic Content Generation<a class="headerlink" href="#dynamic-content-generation" title="Permanent link">&para;</a></h2>
<p>When docma converts HTML into PDF or stand-alone HTML, it needs to resolve all
URLs in the source HTML in things such as <code>&lt;img src="..."&gt;</code> tags. It does this
via a custom <em>URL fetcher</em> that allows content requests to be intercepted and
the resulting content generated dynamically. In this way, docma can generate
dynamic content, such as charts, for inclusion in the final output document.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are some differences in this process depending on whether the final
output is PDF of HTML. See <a href="#dynamic-content-generation-differences-between-pdf-and-html-output">Dynamic Content Generation Differences Between
PDF and HTML
Output</a>.</p>
</div>
<p>All URLs are constituted thus:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-1-1"><span class="err">scheme://netloc/path;parameters?query</span><span class="c">#fragment</span>
</span></code></pre></div>
<p>Docma determines which custom URL fetcher to apply based on the URL scheme (i.e.
the first part before the colon). The URL fetchers handle a range of non-standard,
docma specific schemes, as well as the standard <code>http</code> and <code>https</code> schemes.</p>
<p>Docma currently handles the following non-standard schemes:</p>
<table>
<thead>
<tr>
<th>Scheme</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#scheme-docma">docma</a></td>
<td>Interface to docma dynamic content generators of various types.</td>
</tr>
<tr>
<td><a href="#scheme-file">file</a></td>
<td>Interface to access files contained within the compiled document template.</td>
</tr>
<tr>
<td><a href="#scheme-s3">s3</a></td>
<td>Interface to access files from AWS S3.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The docma URL fetcher interface is easily expandable to handle other
schemes. See <a href="11-extending-docma.html#url-fetchers">URL Fetchers</a>.</p>
</div>
<h3 id="dynamic-content-generation-differences-between-pdf-and-html-output">Dynamic Content Generation Differences Between PDF and HTML Output<a class="headerlink" href="#dynamic-content-generation-differences-between-pdf-and-html-output" title="Permanent link">&para;</a></h3>
<p>PDF generation from HTML is performed by WeasyPrint, which will invoke a custom
URL fetcher for <em>any</em> URL it needs to access during the conversion process.
This includes, <em>but is not limited to</em>, <code>&lt;IMG&gt;</code> tags.</p>
<p>For standalone HTML output, the process of invoking a custom URL fetcher is done
by docma itself. It is <em>only</em> applied to the <code>src</code> attribute of <code>&lt;IMG&gt;</code> tags
under specific circumstances. When it is done, the <code>src</code> attribute is replaced
in the <code>&lt;IMG&gt;</code> tag with the actual content returned by the URL fetcher. i.e.
the data is embedded within the standalone HTML output.</p>
<p>In practice, these differences work naturally, relative to the final viewing
environment for the produced document, static PDF or dynamic HTML.</p>
<p>By default, in HTML outputs, <code>&lt;IMG&gt;</code> tags have the content embedded
in place of the <code>src</code> attribute in the following circumstances:</p>
<ul>
<li>
<p>The <code>src</code> URL is not <code>http(s)://</code> (i.e. any of the docma custom
    schemes described below); or</p>
</li>
<li>
<p>The <code>src</code> URL is <code>http(s)://</code>, has no query component <code>?...</code>, 
    and the content size is between 100 bytes and 1MB in size.</p>
</li>
</ul>
<p>For the <code>http(s)://</code> URLs, it is possible to override the default behaviour by
adding the <code>data-docma-embed</code> attribute to the <code>&lt;IMG&gt;</code> tag.</p>
<p>For images that are not embedded, it is assumed that the client (e.g. an email
client or web browser) will fetch the images as required at display time.</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-2-1"><span class="cm">&lt;!-- Force the image to be embedded --&gt;</span>
</span><span id="__span-2-2"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http://host/img.png&quot;</span> <span class="na">data-docma-embed</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span>
</span><span id="__span-2-3">
</span><span id="__span-2-4"><span class="cm">&lt;!-- Prevent the image from being embedded --&gt;</span>
</span><span id="__span-2-5"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http://host/img.png&quot;</span> <span class="na">data-docma-embed</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="p">&gt;</span>
</span><span id="__span-2-6">
</span><span id="__span-2-7"><span class="cm">&lt;!-- This will not be embedded due to size unless we force it --&gt;</span>
</span><span id="__span-2-8"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http://host/multi-mega-byte-img.png&quot;</span><span class="p">&gt;</span>
</span><span id="__span-2-9">
</span><span id="__span-2-10"><span class="cm">&lt;!-- This will not be embedded due to size unless we force it --&gt;</span>
</span><span id="__span-2-11"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http://host/one-pixel-img.png&quot;</span><span class="p">&gt;</span>
</span><span id="__span-2-12">
</span><span id="__span-2-13"><span class="cm">&lt;!-- This will not be embedded due to query component unless we force it --&gt;</span>
</span><span id="__span-2-14"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;http://host/do/something?x=20&quot;</span><span class="p">&gt;</span>
</span><span id="__span-2-15">
</span><span id="__span-2-16"><span class="cm">&lt;!-- This will always be embedded and cannot be prevented --&gt;</span>
</span><span id="__span-2-17"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;s3://my-bucket/corporate-logo.png&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<h3 id="scheme-docma">Scheme: docma<a class="headerlink" href="#scheme-docma" title="Permanent link">&para;</a></h3>
<p>URLs of the following form are intercepted by docma and used to invoke a dynamic
content generator.</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-3-1"><span class="err">docma:&lt;generator-name&gt;?&lt;generator-params&gt;</span>
</span></code></pre></div>
<p>Note that for these docma URLs, there is no <em>netloc</em> component and hence no <code>//</code>
in the URL.</p>
<p>For example, this will generate a QR code:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-4-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: 40px&quot;</span>
</span><span id="__span-4-2">    <span class="na">src</span><span class="o">=</span><span class="s">&quot;docma:qrcode?text=Hello%s20world&amp;fg=white&amp;bg=red&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>The URL should be properly URL encoded. This can be fiddly, but Jinja can help
here. The example above could also have been written in dictionary format thus:</p>
<div class="language-html+jinja highlight"><pre><span></span><code><span id="__span-5-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: 40px&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">docma:qrcode?</span><span class="cp">{{</span>
</span><span id="__span-5-2">  <span class="o">{</span>
</span><span id="__span-5-3">    <span class="s1">&#39;text&#39;</span><span class="o">:</span> <span class="s1">&#39;Hello world&#39;</span><span class="o">,</span>
</span><span id="__span-5-4">    <span class="s1">&#39;fg&#39;</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span><span class="o">,</span>
</span><span id="__span-5-5">    <span class="s1">&#39;bg&#39;</span><span class="o">:</span> <span class="s1">&#39;red&#39;</span>
</span><span id="__span-5-6">  <span class="o">}</span> <span class="o">|</span> <span class="nf">urlencode</span>
</span><span id="__span-5-7"><span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>It could also have been written as a sequence of tuples:</p>
<div class="language-html+jinja highlight"><pre><span></span><code><span id="__span-6-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: 40px&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">docma:qrcode?</span><span class="cp">{{</span>
</span><span id="__span-6-2">  <span class="o">(</span>
</span><span id="__span-6-3">    <span class="o">(</span><span class="s1">&#39;text&#39;</span><span class="o">,</span> <span class="s1">&#39;Hello world&#39;</span><span class="o">),</span>
</span><span id="__span-6-4">    <span class="o">(</span><span class="s1">&#39;fg&#39;</span><span class="o">,</span> <span class="s1">&#39;white&#39;</span><span class="o">),</span>
</span><span id="__span-6-5">    <span class="o">(</span><span class="s1">&#39;bg&#39;</span><span class="o">,</span> <span class="s1">&#39;red&#39;</span><span class="o">)</span>
</span><span id="__span-6-6">  <span class="o">)</span> <span class="o">|</span> <span class="nf">urlencode</span>
</span><span id="__span-6-7"><span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The sequence format is <strong>required</strong> if any of the parameters needs to be
used more than once.</p>
</div>
<p>Available content generators are:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#generating-qr-codes">qrcode</a></td>
<td>Generate a QR code.</td>
</tr>
<tr>
<td><a href="#generating-graphic-placeholders-swatches">swatch</a></td>
<td>Generate a colour swatch as graphic placeholder.</td>
</tr>
<tr>
<td><a href="#generating-charts-and-graphs">vega</a></td>
<td>Generate a chart based on the <a href="https://vega.github.io/vega-lite/">Vega-Lite</a> declarative syntax for specifying charts / graphs.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The dynamic content generator interface is readily extensible to add new
types of content. See <a href="11-extending-docma.html#content-generators">Content Generators</a>.</p>
</div>
<h4 id="generating-qr-codes">Generating QR Codes<a class="headerlink" href="#generating-qr-codes" title="Permanent link">&para;</a></h4>
<p>The QR code dynamic generator accepts the following parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bg</td>
<td>String</td>
<td>No</td>
<td>Background colour of the QR code (e.g. <code>blue</code> or <code>#0000ff</code>). Default is white.</td>
</tr>
<tr>
<td>border</td>
<td>Integer</td>
<td>No</td>
<td>Number of boxes thick for the border. Default is the minimum allowed value of 4.</td>
</tr>
<tr>
<td>box</td>
<td>Integer</td>
<td>No</td>
<td>Number of pixels for each box in the QR code. Default is 10.</td>
</tr>
<tr>
<td>fg</td>
<td>String</td>
<td>No</td>
<td>Foreground colour of the QR code. Default is black.</td>
</tr>
<tr>
<td>text</td>
<td>String</td>
<td>Yes</td>
<td>Content to be encoded in the QR code.</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-7-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: 40px&quot;</span>
</span><span id="__span-7-2">    <span class="na">src</span><span class="o">=</span><span class="s">&quot;docma:qrcode?text=Hello%s20world&amp;fg=white&amp;bg=red&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<div class="language-html+jinja highlight"><pre><span></span><code><span id="__span-8-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;height: 40px&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">docma:qrcode?</span><span class="cp">{{</span>
</span><span id="__span-8-2">  <span class="o">{</span>
</span><span id="__span-8-3">    <span class="s1">&#39;text&#39;</span><span class="o">:</span> <span class="s1">&#39;Hello world&#39;</span><span class="o">,</span>
</span><span id="__span-8-4">    <span class="s1">&#39;fg&#39;</span><span class="o">:</span> <span class="s1">&#39;white&#39;</span><span class="o">,</span>
</span><span id="__span-8-5">    <span class="s1">&#39;bg&#39;</span><span class="o">:</span> <span class="s1">&#39;red&#39;</span>
</span><span id="__span-8-6">  <span class="o">}</span> <span class="o">|</span> <span class="nf">urlencode</span>
</span><span id="__span-8-7"><span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<h4 id="generating-charts-and-graphs">Generating Charts and Graphs<a class="headerlink" href="#generating-charts-and-graphs" title="Permanent link">&para;</a></h4>
<p>Docma supports the <a href="https://vega.github.io/vega-lite/">Vega-Lite</a> declarative
syntax for specifying charts / graphs. Vega-Lite specifies a mapping between
source data and visual representations of the data. Docma provides mechanisms
for specifying and accessing various data sources and feeding this data through
a Vega-Lite specification to generate charts and graphs.</p>
<p>This is a large topic and more information is provided in
<a href="07-charts-and-graphs.html#charts-and-graphs-in-docma">Charts and Graphs in Docma</a>. To whet your appetite,
check out the <a href="https://vega.github.io/vega-lite/examples/">Vega-Lite sample gallery</a>.</p>
<p>This section just summarises the parameters for the <code>vega</code> content generator for
reference:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>data</td>
<td>String</td>
<td>No</td>
<td>A <a href="08-data-sources.html#data-sources-in-docma">docma data source specification</a>. This argument can be repeated if multiple data sources are required.  If not specified, the file referenced by the <code>spec</code> parameter must contain all of the required data.</td>
</tr>
<tr>
<td>format</td>
<td>String</td>
<td>No</td>
<td>Either <code>svg</code> (the default) or <code>png</code>. Stick to <code>svg</code> if at all possible.</td>
</tr>
<tr>
<td>spec</td>
<td>String</td>
<td>Yes</td>
<td>The name of the file in the compiled document template that contains the Vega-Lite specification for the chart. The contents can be either YAML or JSON.</td>
</tr>
<tr>
<td>ppi</td>
<td>Integer</td>
<td>No</td>
<td>(<code>png</code> format only) Pixels-per-inch resolution of the generated image. Default 72.</td>
</tr>
<tr>
<td>scale</td>
<td>Float</td>
<td>No</td>
<td>(<code>png</code> format only) Scale the chart by the specified factor. Default is 1.0. Generally, it's better to control display size in the HTML but increasing the scale here can improve resolution.</td>
</tr>
<tr>
<td>params</td>
<td>JSON string</td>
<td>No</td>
<td>A string containing a JSON encoded object containing additional rendering parameters used when rendering the <a href="07-charts-and-graphs.html#chart-specification-files">chart specification</a> and any associated <a href="08-data-sources.html#query-specifications">query specifications</a>.</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-9-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 5cm;&quot;</span>
</span><span id="__span-9-2">    <span class="na">src</span><span class="o">=</span><span class="s">&quot;docma:vega?spec=charts/my-chart.yaml&amp;data=...&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<div class="language-html+jinja highlight"><pre><span></span><code><span id="__span-10-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 10cm;&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">docma:vega?</span><span class="cp">{{</span>
</span><span id="__span-10-2">  <span class="o">(</span>
</span><span id="__span-10-3">    <span class="o">(</span> <span class="s1">&#39;spec&#39;</span><span class="o">,</span> <span class="s1">&#39;charts/my-chart.yaml&#39;</span> <span class="o">),</span>
</span><span id="__span-10-4">    <span class="o">(</span> <span class="s1">&#39;data&#39;</span><span class="o">,</span> <span class="s1">&#39;file;data/my-data.csv&#39;</span> <span class="o">),</span>
</span><span id="__span-10-5">    <span class="o">(</span> <span class="s1">&#39;params&#39;</span><span class="o">,</span> <span class="o">{</span> <span class="s1">&#39;extra_rendering_param&#39;</span><span class="o">:</span> <span class="m">1234</span> <span class="o">}</span> <span class="o">|</span> <span class="nf">tojson</span><span class="o">)</span>
</span><span id="__span-10-6">  <span class="o">)</span> <span class="o">|</span> <span class="nf">urlencode</span>
</span><span id="__span-10-7"><span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<h4 id="generating-graphic-placeholders-swatches">Generating Graphic Placeholders (Swatches)<a class="headerlink" href="#generating-graphic-placeholders-swatches" title="Permanent link">&para;</a></h4>
<p>The swatch generator produces a simple coloured rectangle with an optional text
message. It's not intended to be useful in final documents, Mondrian
notwithstanding. It has two purposes:</p>
<ol>
<li>
<p>As a simple code sample for dynamic content generators that can be copied
    and modified for new requirements.</p>
</li>
<li>
<p>As a temporary placeholder when developing the structure of a docma template
    that will be replaced subsequently by a real piece of content (e.g. a chart).</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>color</td>
<td>String</td>
<td>No</td>
<td>Fill colour of the swatch. Default is a light grey.</td>
</tr>
<tr>
<td>font</td>
<td>String</td>
<td>No</td>
<td>Font file name for the text. Default is <code>Arial</code>. If the specified font is not available, a platform specific default is used.</td>
</tr>
<tr>
<td>font_size</td>
<td>Integer</td>
<td>No</td>
<td>Font size. Default is 18.</td>
</tr>
<tr>
<td>height</td>
<td>Integer</td>
<td>Yes</td>
<td>Swatch height in pixels.</td>
</tr>
<tr>
<td>text</td>
<td>String</td>
<td>No</td>
<td>Text to centre in the swatch. No effort is made to manipulate it to fit.</td>
</tr>
<tr>
<td>text_color</td>
<td>String</td>
<td>No</td>
<td>Colour for text. Default is black.</td>
</tr>
<tr>
<td>width</td>
<td>Integer</td>
<td>Yes</td>
<td>Swatch width in pixels.</td>
</tr>
</tbody>
</table>
<p>!!! question <em>Colour</em> or <em>color</em>?
    The code and docma templates stick with <code>color</code>, because, well, that battle
    is lost. The user guide uses <code>colour</code> in descriptive text. Blame Webster for
    messing it up, not me.</p>
<p>Examples:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-11-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;docma:swatch?width=150&amp;height=150&amp;color=seagreen&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<div class="language-html+jinja highlight"><pre><span></span><code><span id="__span-12-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;docma:swatch?</span><span class="cp">{{</span> <span class="o">{</span>
</span><span id="__span-12-2">    <span class="s1">&#39;width&#39;</span><span class="o">:</span> <span class="m">150</span><span class="o">,</span>
</span><span id="__span-12-3">    <span class="s1">&#39;height&#39;</span><span class="o">:</span> <span class="m">150</span><span class="o">,</span>
</span><span id="__span-12-4">    <span class="s1">&#39;color&#39;</span><span class="o">:</span> <span class="s1">&#39;#0080ff&#39;</span><span class="o">,</span>
</span><span id="__span-12-5">    <span class="s1">&#39;text&#39;</span><span class="o">:</span> <span class="s1">&#39;Hello world&#39;</span><span class="o">,</span>
</span><span id="__span-12-6">    <span class="s1">&#39;text_color&#39;</span><span class="o">:</span> <span class="s1">&#39;yellow&#39;</span><span class="o">,</span>
</span><span id="__span-12-7">    <span class="s1">&#39;font_size&#39;</span><span class="o">:</span> <span class="m">24</span>
</span><span id="__span-12-8">    <span class="o">}</span> <span class="o">|</span> <span class="nf">urlencode</span> <span class="cp">}}</span><span class="s">&quot;</span>
</span><span id="__span-12-9"><span class="p">&gt;</span>
</span></code></pre></div>
<h3 id="scheme-file">Scheme: file<a class="headerlink" href="#scheme-file" title="Permanent link">&para;</a></h3>
<p>URLs in HTML files of the form <code>file:...</code> are intercepted by docma and the
content is extracted from a file within the compiled document template. As the
file is local to the template, there is no network location so the URL will be
like so:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-13-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;file:resources/logo.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;logo&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not include <code>//</code> after <code>file:</code>. It will not work.</p>
</div>
<h3 id="scheme-s3">Scheme: s3<a class="headerlink" href="#scheme-s3" title="Permanent link">&para;</a></h3>
<p>URLs in HTML files of the form <code>s3://...</code> are intercepted by docma and the
content is extracted from AWS S3. A typical usage would be something like:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-14-1"><span class="p">&lt;</span><span class="nt">IMG</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;s3://my-bucket/some/path/logo.png&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;logo&quot;</span><span class="p">&gt;</span>
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Files are limited to 10MB in size.</p>
</div>
<h2 id="watermarking">Watermarking<a class="headerlink" href="#watermarking" title="Permanent link">&para;</a></h2>
<p><strong>Docma</strong> supports the ability to watermark and stamp PDF documents using
the concept of document <em>overlays</em>.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Overlays are not supported for HTML output documents.</p>
</div>
<p>An <strong>overlay</strong> is a PDF document, generated by <strong>docma</strong> that can be used as
either a watermark or a stamp.</p>
<p>A <strong>watermark</strong> is content merged into every page of the final PDF <strong>under</strong> the
main document content.</p>
<p>A <strong>stamp</strong> is content merged into every page of the final PDF <strong>over</strong> the
main document content.</p>
<p>Overlays are defined in the <a href="03-document-templates.html#template-configuration-file">template configuration file</a>
using the following structure:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><span class="nt">overlays</span><span class="p">:</span>
</span><span id="__span-15-2"><span class="w">  </span><span class="nt">my-overlay-1</span><span class="p">:</span>
</span><span id="__span-15-3"><span class="w">    </span><span class="c1"># We can have HTML files that will be rendered like other docs</span>
</span><span id="__span-15-4"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a4-portrait.html</span>
</span><span id="__span-15-5"><span class="w">    </span><span class="c1"># ... or static PDFs</span>
</span><span id="__span-15-6"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a4-landscape.pdf</span>
</span><span id="__span-15-7">
</span><span id="__span-15-8"><span class="w">  </span><span class="c1"># or ...</span>
</span><span id="__span-15-9"><span class="w">  </span><span class="nt">my-overlay-2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a4-portrait.html</span>
</span></code></pre></div>
<p>Each overlay is a named list of documents (or a single document). When <strong>docma</strong>
is requested to add a watermark (or stamp), it is provided with the name of one
or more of the overlays (e.g. <code>my-overlay-1</code>).</p>
<p>It will then render each of the files in each overlay list in the same way as the
main document, including rendering with dynamic run-time parameters.</p>
<p>Each page in the main document is then merged with the first page of the first
overlay document in each list that has (approximately) the same page dimensions.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The process will abort if a matching overlay page cannot be found for a main
document page.</p>
</div>
<p>The presence of the <code>overlays</code> section in the configuration file does not itself
enable watermarking / stamping. This has to be explicitly requested.</p>
<p>Watermarking / stamping can be requested using the <code>--watermark</code> / <code>--stamp</code>
CLI options. If using the Python API, the <code>watermark</code> / <code>stamp</code> parameters to the
<code>render_template()</code> function are used.</p>
<p>It is possible to have both watermarking and stamping used on a single document,
as well as having multiple overlays applied to a single document.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>A simple grid overlay is provided as part of the basic template created by
the <a href="10-installation-and-usage.html#creating-a-new-document-template">docma new</a> command. This can be
handy when adjusting page layout. To add the grid, the docma CLI rendering
command would be <code>docma pdf --stamp grid ...</code>. Grid size and colour are
adjustable in the parameter defaults in the template config file.</p>
</div>
<h2 id="document-metadata">Document Metadata<a class="headerlink" href="#document-metadata" title="Permanent link">&para;</a></h2>
<p>Docma allows the template to control some of the metadata added to the final PDF
or HTML and enforces some values of its own.</p>
<p>PDF and HTML documents have slightly different conventions regarding metadata
naming and formatting. Docma handles these variations.</p>
<p>In HTML, the metadata fields are added into the <code>&lt;HEAD&gt;</code> of the final document
in this form:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-16-1"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;Fred Nurk&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;author&quot;</span><span class="p">/&gt;</span>
</span><span id="__span-16-2"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;A document about stuff&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">/&gt;</span>
</span><span id="__span-16-3"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;DRAFT, Top-Secret&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;keywords&quot;</span><span class="p">/&gt;</span>
</span><span id="__span-16-4"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;2024-11-21T00:04:38.699978+00:00&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;creation_date&quot;</span><span class="p">/&gt;</span>
</span></code></pre></div>
<p>In PDF, the meta data fields are used to populate the standard metadata elements
recognised by common PDF readers.</p>
<table>
<thead>
<tr>
<th>HTML Naming</th>
<th>PDF Naming</th>
<th>Controlled by</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>author</td>
<td>/Author</td>
<td>Template</td>
<td>From the <code>metadata-&gt;author</code> key in <code>config.yaml</code></td>
</tr>
<tr>
<td>creation_date</td>
<td>/CreationDate</td>
<td>Docma</td>
<td>Document production datetime</td>
</tr>
<tr>
<td>creator</td>
<td>/Creator</td>
<td>Docma</td>
<td>Based on template <code>id</code>, <code>version</code> and docma version</td>
</tr>
<tr>
<td>keywords</td>
<td>/Keywords</td>
<td>Template</td>
<td>From the <code>metadata-&gt;keywords</code> key in <code>config.yaml</code></td>
</tr>
<tr>
<td>subject</td>
<td>/Subject</td>
<td>Template</td>
<td>From the <code>metadata-&gt;subject</code> key in <code>config.yaml</code></td>
</tr>
<tr>
<td>title</td>
<td>/Title</td>
<td>Template</td>
<td>From the <code>metadata-&gt;title</code> key in <code>config.yaml</code></td>
</tr>
</tbody>
</table>
<h2 id="batch-rendering">Batch Rendering<a class="headerlink" href="#batch-rendering" title="Permanent link">&para;</a></h2>
<p>Docma supports the ability to generate a batch of output documents from a single
document template using the <code>pdf-batch</code> (PDF) and <code>html-batch</code> (HTML) sub-commands
of the <a href="10-installation-and-usage.html#the-docma-cli">docma CLI</a>.</p>
<p>The document template needs to anticipate the need for batch rendering by
including some Jinja controlled content that will be varied for each document
produced via document specific parameters. The source for the document specific
batch parameters is a <a href="08-data-sources.html#data-sources-in-docma">docma data loader</a>. Data returned
by the data loader is merged in with the fixed rendering parameters, a row at a
time, and docma produces an output document using that combination. The source
data for the batch parameters is specified using a <a href="08-data-sources.html#data-source-specifications">docma data source
specification</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following describes the process for PDF document batches. The process is
similar for HTML batches.</p>
</div>
<p><img alt="" src="img/render-batch.svg" /></p>
<p>This is how a batch rendering is invoked:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><span class="c1"># Long form arguments</span>
</span><span id="__span-17-2">docma<span class="w"> </span>pdf-batch<span class="w"> </span>--template<span class="w"> </span>my-template.zip<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-3"><span class="w">    </span>--file<span class="w"> </span>static-params.yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-4"><span class="w">    </span>--data-source-spec<span class="w"> </span><span class="s1">&#39;postgres;pglocal;queries/batch.yaml&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-5"><span class="w">    </span>--output<span class="w"> </span><span class="s1">&#39;whatever-{{id}}-{{familyname|lower}}.pdf&#39;</span>
</span><span id="__span-17-6">
</span><span id="__span-17-7"><span class="c1"># Short form arguments</span>
</span><span id="__span-17-8">docma<span class="w"> </span>pdf-batch<span class="w"> </span>-t<span class="w"> </span>my-template.zip<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-9"><span class="w">    </span>-f<span class="w"> </span>static-params.yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-10"><span class="w">    </span>-d<span class="w"> </span><span class="s1">&#39;postgres;pglocal;queries/batch.yaml&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-17-11"><span class="w">    </span>-o<span class="w"> </span><span class="s1">&#39;whatever-{{id}}-{{familyname|lower}}.pdf&#39;</span>
</span></code></pre></div>
<p>Let's examine this bit by bit.</p>
<p>The docma <code>pdf-batch</code> sub-command is invoked specifying the compiled document
template:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1">docma<span class="w"> </span>pdf-batch<span class="w"> </span>--template<span class="w"> </span>my-template.zip
</span></code></pre></div>
<p>Rendering parameters are specified exactly as for the single document rendering
process. These parameters are the same for every document in the rendering batch:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><span class="w">    </span>--file<span class="w"> </span>static-params.yaml<span class="w"> </span><span class="se">\</span>
</span></code></pre></div>
<p>The <a href="08-data-sources.html#data-source-specifications">docma data source specification</a> tells docma
how to obtain rows of data to control the batch rendering. Each row is a set of
key/value pairs that will be merged into the static rendering parameters and
used to render one PDF document:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><span class="w">    </span>--data-source-spec<span class="w"> </span><span class="s1">&#39;postgres;pglocal;queries/batch.yaml&#39;</span><span class="w"> </span><span class="se">\</span>
</span></code></pre></div>
<p>The <a href="08-data-sources.html#data-source-specifications">docma data source specification</a>
is interpreted within the context of the document template.</p>
<p>As docma will be producing a series of PDF documents, it needs a mechanism to
provide each document with a unique name that corresponds to the batch data
entry that was used to produce it. This is done using the <code>--output</code> option with
an argument that is Jinja rendered to construct the filename. In this example,
it is assumed that the batch data contains <code>id</code> and <code>familyname</code> elements and
that these are a unique combination to avoid filename clashes:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><span class="w">    </span>--output<span class="w"> </span><span class="s1">&#39;whatever-{{id}}-{{familyname|lower}}.pdf&#39;</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are some strict constraints on the filename rendering process for
safety reasons.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; Origin Energy
    </div>
  
</div>
      <div class="md-footer-social">
        <div class="md-copyright">
          <div class="md-copyright__highlight">
            v2.2.0
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant", "content.code.copy"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>