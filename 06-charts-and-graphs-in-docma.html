<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Murray Andrews" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Charts and Graphs in Docma - Docma User Guide</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Charts and Graphs in Docma";
        var mkdocs_page_input_path = "06-charts-and-graphs-in-docma.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="index.html" class="icon icon-home"> Docma User Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="01-overview.html">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="02-document-creation.html">Document Creation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="03-document-templates.html">Document Templates</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="04-docma-template-compilation.html">Docma Template Compilation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="05-docma-template-rendering.html">Docma Template Rendering</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Charts and Graphs in Docma</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#invoking-charts-in-html-source-documents">Invoking Charts in HTML Source Documents</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#chart-specification-files">Chart Specification Files</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#source-data-for-charts">Source Data for Charts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#tips-and-suggestions-for-designing-charts">Tips and Suggestions for Designing Charts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#samples">Samples</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#bar-chart">Bar Chart</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#interval-meter-data-heat-map">Interval Meter Data Heat Map</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="07-data-sources-in-docma.html">Data Sources in Docma</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="08-fonts.html">Fonts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="09-installation-and-usage.html">Installation and Usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="10-caveats-and-known-issues.html">Caveats and Known Issues</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="11-credits.html">Credits</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="12-release-notes.html">Release Notes</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Docma User Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html" class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Charts and Graphs in Docma</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="charts-and-graphs-in-docma">Charts and Graphs in Docma</h1>
<p>Docma supports the <a href="https://vega.github.io/vega-lite/">Vega-Lite</a> declarative
syntax for specifying charts / graphs. Vega-Lite specifies a mapping between
source data and visual representations of the data.</p>
<p>To make all this work in docma requires three things:</p>
<ol>
<li>
<p>A means to tell docma that a chart needs to be generated. This is done using
    a special URL format within <code>&lt;IMG&gt;</code> tags in the source HTML.
    See <a href="#invoking-charts-in-html-source-documents">Invoking Charts in HTML Source Documents</a>.</p>
</li>
<li>
<p>A means to specify the design of the chart. This is done with a
    <a href="#chart-specification-files">chart specification file</a> within the document
    template.</p>
</li>
<li>
<p>A means to feed data to the chart creation process.
    See <a href="#source-data-for-charts">Source Data for Charts</a>.</p>
</li>
</ol>
<h2 id="invoking-charts-in-html-source-documents">Invoking Charts in HTML Source Documents</h2>
<p>Docma provides a URL based mechanism to trigger creation of charts during the
process of converting HTML to a PDF or HTML output document. See
<a href="05-docma-template-rendering.html#dynamic-content-generation">Dynamic Content Generation</a> for more details.</p>
<p>It looks like this:</p>
<pre><code class="language-html">&lt;IMG src=&quot;docma:vega?spec=charts/my-chart.yaml&amp;data=...&quot;&gt;
</code></pre>
<p>In a nutshell, when docma sees a URL in this form, it knows to
get data from the source specified by the <code>data</code> parameter and feed it into the
chart generator with the Vega-Lite specification indicated by the <code>spec</code>
parameter:</p>
<p>Normal CSS styling can also be applied:</p>
<pre><code class="language-html">&lt;IMG style=&quot;width: 5cm;&quot;
    src=&quot;docma:vega?spec=charts/my-chart.yaml&amp;data=...&quot;&gt;
</code></pre>
<p>Here is a more complete example, showing how Jinja can help build the <code>src</code> URL
structure safely:</p>
<pre><code class="language-html">&lt;IMG style=&quot;width: 10cm;&quot; src=docma:vega?{{
  (
    ( 'spec', 'charts/my-chart.yaml' ),
    ( 'data', 'file;data/my-data.csv' ),
    ( 'params', { 'extra_rendering_param': 1234 } | tojson)
  ) | urlencode
}}&quot;&gt;
</code></pre>
<p>See also <a href="05-docma-template-rendering.html#generating-charts-and-graphs">docma scheme parameters for vega charts</a>.</p>
<h2 id="chart-specification-files">Chart Specification Files</h2>
<p>The chart specification is a file in the document template containing a
<a href="https://vega.github.io/vega-lite/">Vega-Lite</a> chart definition.</p>
<p>The chart specification will be Jinja rendered prior to use.</p>
<p>The chart specification can be in either JSON or YAML format.
Docma doesn't care which. There are pros and cons with each format.
YAML is easier to write and to read but JSON is the native format of the
examples in the <a href="https://vega.github.io/vega-lite/examples/">Vega-Lite sample gallery</a>
or the <a href="https://vega.github.io/editor/#/">Vega-Lite on-line editor</a>. You're 
going to want to use both of these resources.</p>
<p>The chart specification file should still have a <code>.yaml</code> suffix, even if the
contents are JSON. This all works because valid JSON is also valid YAML.</p>
<blockquote>
<p>Note that docma uses the <a href="https://altair-viz.github.io/index.html">Vega-Altair</a>
Python package to process Vega-Lite specifications.</p>
</blockquote>
<h2 id="source-data-for-charts">Source Data for Charts</h2>
<p>The value of the <code>data</code> parameter in a <code>docma:vega?...</code> URL is a docma <a href="07-data-sources-in-docma.html#data-source-specifications">data
source specification</a> that indicates where to obtain
the data and where to attach it to the chart specification.</p>
<p>The <code>data</code> parameter can be used multiple times if there are multiple data
sources in the chart.</p>
<p>If the <code>data</code> parameter is not specified, the source data is assumed to be
contained within the chart specification itself. This can actually be useful
when designing a chart to avoid the need to wrangle external data when
experimenting.</p>
<p>See <a href="07-data-sources-in-docma.html#data-sources-in-docma">Data Sources in Docma</a> for more information.</p>
<h2 id="tips-and-suggestions-for-designing-charts">Tips and Suggestions for Designing Charts</h2>
<p>The <a href="https://vega.github.io/vega-lite/">Vega-Lite website</a> has lots of resources
to help with designing charts. This section just provides a few tips and
suggestions.</p>
<p>Some suggestions for simplifying the development:</p>
<ul>
<li>
<p>Where possible, start with a chart from the
    <a href="https://vega.github.io/vega-lite/examples/">Vega-Lite sample gallery</a> and
    play with it in the on-line editor to get close to what you are after.</p>
</li>
<li>
<p>Include a small sample data set in the chart specification to allow
    experimentation. The sample data can be left in the specification when
    included into a docma document template. Docma will replace it at run-time.</p>
</li>
<li>
<p>Charts reference a JSON schema:
    <code>$schema: https://vega.github.io/schema/vega-lite/v5.json</code>. PyCharm will
    interpret this and provide some auto completion and validation as you go.</p>
</li>
<li>
<p>Believe it, or not, but ChatGPT is surprisingly helpful with Vega-Lite. It
    can often give meaningful answers to enquiries like these:</p>
<ul>
<li>
<p><em>Explain this Vega-Lite specification to me ... (paste the JSON in)</em></p>
</li>
<li>
<p><em>I have this Vega-Lite specification. How do I remove the axes and
    change the colour on the bars?</em></p>
</li>
<li>
<p><em>Design a Vega-Lite chart that shows a heat map of ... with ... on the x
    axis and ... on the y axis</em></p>
</li>
</ul>
</li>
<li>
<p>ChatGPT can get confused with obscure concepts (like interval meter data).
    You can often replace this with more generic data in the questions
    (temperature data is a good substitute for interval data).</p>
</li>
<li>
<p><a href="https://vega.github.io/vega-lite/docs/layer.html">Layers</a> are quite an
    important concept in Vega-Lite. Make an effort to understand them.</p>
</li>
</ul>
<h2 id="samples">Samples</h2>
<p>With a bit of effort, Vega-Lite does a surprisingly good job of generating good
looking charts with a small amount of specification.</p>
<p>Here are a few examples.</p>
<h3 id="bar-chart">Bar Chart</h3>
<p>This is a bar chart of dog woof-power.</p>
<p><img alt="" src="img/samples/woof.png" /></p>
<p>This is the specification file (with truncated data).</p>
<pre><code class="language-yaml">$schema: 'https://vega.github.io/schema/vega-lite/v5.json'
width: 300
config:
  font: Avenir
  background: '#eeeeee'
  padding: 10
  view:
    stroke: transparent
  axisX:
    grid: false
    gridWidth: 0.5
    domainDash:
      - 4
      - 4
    formatType: number
  axisY:
    grid: false
data:
  values:
    - Dog: Bolliver
      Woof: 28
view:
  fill: '#eeeeee'
encoding:
  'y':
    field: Dog
    title: Dog
    type: ordinal
    axis: null
layer:
  - mark:
      type: bar
      cornerRadius: 20
    encoding:
      x:
        field: Woof
        title: null
        type: quantitative
      color:
        field: Woof
        type: quantitative
        title: '% Woof'
        scale:
          domain: [ 0, 100 ]
          range: [ '#fec72b', '#fa4617' ]
  - mark:
      type: text
      align: left
      x: 10
      color: white
      fontWeight: bold
    encoding:
      text:
        field: Dog
</code></pre>
<h3 id="interval-meter-data-heat-map">Interval Meter Data Heat Map</h3>
<p>This is a heat map of interval meter data by day and month.</p>
<p><img alt="" src="img/samples/heatmap.png" /></p>
<p>This is the specification file (with truncated data).</p>
<pre><code class="language-yaml">$schema: 'https://vega.github.io/schema/vega-lite/v5.json'
title: 'Daily Usage'
config:
  font: Avenir
  view:
    continuousWidth: 300
    continuousHeight: 300
    step: 13
    strokeWidth: 0
  axis:
    domain: false
data:
  name: usage_by_day

mark:
  type: rect
encoding:
  color:
    aggregate: max
    field: kwh
    legend:
      title: kWh
    type: quantitative
    scale:
      range: [ '#fec72b', '#fa4617' ]
  x:
    axis:
      format: '%e'
      labelAngle: 0
    field: date
    timeUnit: date
    title: Day
    type: ordinal
  y:
    field: date
    timeUnit: month
    title: Month
    type: ordinal
datasets:
  # Sample data -- this gets replaced
  usage_by_day:
    - date: 2023-07-01
      kwh: 1234
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="05-docma-template-rendering.html" class="btn btn-neutral float-left" title="Docma Template Rendering"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="07-data-sources-in-docma.html" class="btn btn-neutral float-right" title="Data Sources in Docma">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>(C) Origin Energy</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="05-docma-template-rendering.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="07-data-sources-in-docma.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
