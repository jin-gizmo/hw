
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Document manufacture for fun and profit">
      
      
        <meta name="author" content="Murray Andrews">
      
      
      
        <link rel="prev" href="05-template-rendering.html">
      
      
        <link rel="next" href="07-charts-and-graphs.html">
      
      
      <link rel="icon" href="img/docma-logo/png/docma-icon-light.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Jinja Rendering - Docma User Guide</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/extra.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docma-jinja-rendering" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Docma User Guide" class="md-header__button md-logo" aria-label="Docma User Guide" data-md-component="logo">
      
  <img src="img/docma-logo/svg/docma-icon-mid-2.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docma User Guide
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Jinja Rendering
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Docma User Guide" class="md-nav__button md-logo" aria-label="Docma User Guide" data-md-component="logo">
      
  <img src="img/docma-logo/svg/docma-icon-mid-2.svg" alt="logo">

    </a>
    Docma User Guide
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="01-overview.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="02-document-creation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Creation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="03-document-templates.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Templates
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="04-template-compilation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template Compilation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="05-template-rendering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Template Rendering
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Jinja Rendering
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="06-jinja-rendering.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Jinja Rendering
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rendering-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rendering Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rendering-parameters-provided-by-docma" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering Parameters Provided by Docma
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-jinja-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Jinja Filters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docma Jinja Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Generic Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regional-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Regional Filters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-jinja-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Jinja Extensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-format-checkers" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Format Checkers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docma Format Checkers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-format-checkers" class="md-nav__link">
    <span class="md-ellipsis">
      Generic Format Checkers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regional-format-checkers" class="md-nav__link">
    <span class="md-ellipsis">
      Regional Format Checkers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-checkers-in-json-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Format Checkers in JSON Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-checkers-in-jinja" class="md-nav__link">
    <span class="md-ellipsis">
      Format Checkers in Jinja
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="07-charts-and-graphs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Charts and Graphs
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="08-data-sources.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Sources
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="09-fonts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fonts
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="10-installation-and-usage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation and Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="11-extending-docma.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Extending Docma
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="12-api.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="13-caveats-and-issues.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Caveats and Issues
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="14-credits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Credits
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="15-release-notes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release Notes
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rendering-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering Parameters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rendering Parameters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rendering-parameters-provided-by-docma" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering Parameters Provided by Docma
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-jinja-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Jinja Filters
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docma Jinja Filters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Generic Filters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regional-filters" class="md-nav__link">
    <span class="md-ellipsis">
      Regional Filters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-jinja-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Jinja Extensions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docma-format-checkers" class="md-nav__link">
    <span class="md-ellipsis">
      Docma Format Checkers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docma Format Checkers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-format-checkers" class="md-nav__link">
    <span class="md-ellipsis">
      Generic Format Checkers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#regional-format-checkers" class="md-nav__link">
    <span class="md-ellipsis">
      Regional Format Checkers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-checkers-in-json-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Format Checkers in JSON Schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format-checkers-in-jinja" class="md-nav__link">
    <span class="md-ellipsis">
      Format Checkers in Jinja
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="docma-jinja-rendering">Docma Jinja Rendering<a class="headerlink" href="#docma-jinja-rendering" title="Permanent link">&para;</a></h1>
<p>The rendering phase uses Jinja to render HTML content with the parameters
provided at run-time. Other components (e.g.
<a href="08-data-sources.html#query-specifications">query specifications</a>) also use Jinja rendering on some
of their content.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The docma Jinja subsystem has been refactored somewhat in v2.2.0.</p>
</div>
<p>All of the facilities provided by Jinja are available, including parameter
injection, loops, conditional content and use of the <code>include</code> directive to
incorporate other content from the document template. Include directives should
use the name of the file relative to the template root. e.g.</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-0-1"><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;my-file.html&#39;</span> <span class="cp">%}</span>
</span></code></pre></div>
<p>See also <a href="#rendering-parameters-provided-by-docma">Jinja Rendering Parameters Provided by
Docma</a>.</p>
<p>In addition to standard Jinja facilities, docma also provides a number of extra
<a href="#docma-jinja-filters">filters</a> and
<a href="#docma-jinja-extensions">extensions</a>.</p>
<h2 id="rendering-parameters">Rendering Parameters<a class="headerlink" href="#rendering-parameters" title="Permanent link">&para;</a></h2>
<p>The parameters used by docma during the template rendering process is the union
of the following (from highest to lowest precedence):</p>
<ol>
<li>
<p><a href="#rendering-parameters-provided-by-docma">Parameters provided by docma</a>.</p>
</li>
<li>
<p>Parameters supplied by the user at run-time.</p>
</li>
<li>
<p>Parameters specified under <code>parameters-&gt;defaults</code> in the
    <a href="03-document-templates.html#template-configuration-file">template configuration file</a></p>
</li>
</ol>
<p>Parameters are any object that can be represented in JSON / standard YAML, which
can include arbitrary combinations of objects, lists and scalar values.</p>
<p>The marshalling process <em>deep-merges</em> the parameter trees from each source. Lists
are not merged. One list will replace another if they occur at the same location.</p>
<h3 id="rendering-parameters-provided-by-docma">Rendering Parameters Provided by Docma<a class="headerlink" href="#rendering-parameters-provided-by-docma" title="Permanent link">&para;</a></h3>
<p>In addition to user supplied parameters, docma includes the following items
under the <code>docma</code> key.</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Notes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>calendar</td>
<td></td>
<td>The Python <code>calendar</code> module.</td>
</tr>
<tr>
<td>data</td>
<td></td>
<td>Function to invoke a <a href="08-data-sources.html#data-sources-in-docma">docma data provider</a> and return the data as a list of dictionaries. See <a href="08-data-sources.html#data-source-specifications-for-html-rendering">Data Source Specifications for HTML Rendering</a>.</td>
</tr>
<tr>
<td>datetime</td>
<td></td>
<td>The Python <code>datetime</code> module.</td>
</tr>
<tr>
<td>format</td>
<td></td>
<td>The format of the output document to be produced, <code>PDF</code> or <code>HTML</code>. This can be used, among other things, for format specific content or formatting (e.g. CSS variations).</td>
</tr>
<tr>
<td>paramstyle</td>
<td>(1)</td>
<td>Corresponds to the DBAPI 2.0 <code>paramstyle</code> attribute of the underlying database driver when processing a  <a href="08-data-sources.html#query-specifications">query specification</a>.</td>
</tr>
<tr>
<td>template</td>
<td></td>
<td>An object containing information about the document template.</td>
</tr>
<tr>
<td>--&gt; description</td>
<td></td>
<td>The <code>description</code> field from the <a href="03-document-templates.html#template-configuration-file">template configuration file</a>.</td>
</tr>
<tr>
<td>--&gt; doc_no</td>
<td>(2)</td>
<td>The document number in the list being included in the final document, starting at 1.</td>
</tr>
<tr>
<td>--&gt; document</td>
<td>(2)</td>
<td>The path for the source document being processed. This is a pathlib <code>Path()</code> instance.</td>
</tr>
<tr>
<td>--&gt; id</td>
<td></td>
<td>The <code>id</code> field from the <a href="03-document-templates.html#template-configuration-file">template configuration file</a>.</td>
</tr>
<tr>
<td>--&gt; overlay_id</td>
<td>(3)</td>
<td>The ID of the current overlay set being rendered.</td>
</tr>
<tr>
<td>--&gt; overlay_path</td>
<td>(3)</td>
<td>The path for the current overlay file being rendered. This is a pathlib <code>Path()</code> instance.</td>
</tr>
<tr>
<td>--&gt; page</td>
<td>(2)</td>
<td>The starting page number for the current document with respect to the final output document. This may be useful for manipulating page numbering in multipart documents. Or not.</td>
</tr>
<tr>
<td>--&gt; version</td>
<td></td>
<td>The <code>version</code> field from the <a href="03-document-templates.html#template-configuration-file">template configuration file</a>.</td>
</tr>
<tr>
<td>version</td>
<td></td>
<td>The docma version.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Notes</p>
<ol>
<li>The <code>paramstyle</code> parameter is only available for use in
    <a href="08-data-sources.html#query-specifications">query specifications</a>.</li>
<li>
<p>The <code>template.doc_no</code>, <code>template.document</code> and <code>template.page</code> parameters
    are only available when a document file is being rendered (i.e. not when an
    overlay is being rendered). The <code>template.page</code> parameter is only available
    for PDF outputs.</p>
</li>
<li>
<p>The <code>template.overlay_id</code> and <code>template.overlay_path</code> parameters are only
    available when an overlay file is being rendered.</p>
</li>
</ol>
</div>
<p>For example, to insert today's date:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-1-1"><span class="cp">{{</span> <span class="nv">docma.datetime.date.today</span><span class="o">()</span> <span class="o">|</span> <span class="nf">date</span> <span class="cp">}}</span><span class="x"> -- &quot;date&quot; filter formats for locale</span>
</span></code></pre></div>
<p>To check whether we are producing HTML or PDF:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-2-1"><span class="x">This is </span><span class="cp">{{</span> <span class="nv">docma.format</span> <span class="cp">}}</span><span class="x"> output using docma version </span><span class="cp">{{</span> <span class="nv">docma.version</span> <span class="cp">}}</span><span class="x">.</span>
</span></code></pre></div>
<h2 id="docma-jinja-filters">Docma Jinja Filters<a class="headerlink" href="#docma-jinja-filters" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Jinja filter management has changed significantly in <strong>docma</strong> 2.2. Some
filters have been renamed (with backward compatible aliases) and a new, more
extensible filter plugin system has been implemented.</p>
</div>
<p>In addition to the standard filters provided by Jinja, <strong>docma</strong> provides a
number of additions. These are divided into:</p>
<ul>
<li><a href="#generic-filters">Generic filters</a></li>
<li><a href="#regional-filters">Region / country specific filters</a>.</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Custom filter names are not case sensitive.</p>
</div>
<h3 id="generic-filters">Generic Filters<a class="headerlink" href="#generic-filters" title="Permanent link">&para;</a></h3>
<p>Filters marked with * are locale aware.</p>
<table>
<thead>
<tr>
<th>Filter Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#jinja-filter-compact_decimal">compact_decimal</a> *</td>
<td>Format a number in a compact format.</td>
</tr>
<tr>
<td><a href="#jinja-filter-css_id">css_id</a></td>
<td>Sanitise a string to be a valid CSS identifier.</td>
</tr>
<tr>
<td><a href="#jinja-filter-currency">currency</a> *</td>
<td>Format currency.</td>
</tr>
<tr>
<td><a href="#jinja-filter-date">date</a> *</td>
<td>Format a date.</td>
</tr>
<tr>
<td><a href="#jinja-filter-datetime">datetime</a> *</td>
<td>Format a datetime.</td>
</tr>
<tr>
<td><a href="#jinja-filter-decimal">decimal</a> *</td>
<td>Format a number.</td>
</tr>
<tr>
<td><a href="#jinja-filter-dollars">dollars</a></td>
<td>Legacy. Format currency a value as dollars.</td>
</tr>
<tr>
<td><a href="#jinja-filter-parse_date">parse_date</a> *</td>
<td>Parse a date string into a <a href="https://docs.python.org/3/library/datetime.html#datetime.date">datetime.date</a> instance.</td>
</tr>
<tr>
<td><a href="#jinja-filter-parse_time">parse_time</a> *</td>
<td>Parse a date string into a <a href="https://docs.python.org/3/library/datetime.html#datetime.time">datetime.time</a> instance.</td>
</tr>
<tr>
<td><a href="#jinja-filter-percent">percent</a> *</td>
<td>Format a percentage.</td>
</tr>
<tr>
<td><a href="#jinja-filter-phone">phone</a> *</td>
<td>Format a phone number.</td>
</tr>
<tr>
<td><a href="#jinja-filter-require">require</a></td>
<td>Abort with an error message an expression does not have a truthy value.</td>
</tr>
<tr>
<td><a href="#jinja-filter-sql_safe">sql_safe</a></td>
<td>Ensure that a string value is safe to use in SQL and generate an error if not.</td>
</tr>
<tr>
<td><a href="#jinja-filter-time">time</a> *</td>
<td>Format a time value.</td>
</tr>
<tr>
<td><a href="#jinja-filter-timedelta">timedelta</a> *</td>
<td>Format a timedelta value.</td>
</tr>
</tbody>
</table>
<h3 id="regional-filters">Regional Filters<a class="headerlink" href="#regional-filters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Filter Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>abn</td>
<td>Deprecated. Use <a href="#jinja-filter-auabn">au.abn</a>.</td>
</tr>
<tr>
<td>acn</td>
<td>Deprecated. Use <a href="#jinja-filter-auacn">au.abn</a>.</td>
</tr>
<tr>
<td><a href="#jinja-filter-auabn">au.abn</a></td>
<td>Format an Australian Business Number (ABN).</td>
</tr>
<tr>
<td><a href="#jinja-filter-auacn">au.acn</a></td>
<td>Format an Australian Company Number (ACN).</td>
</tr>
</tbody>
</table>
<h4 id="jinja-filter-auabn">Jinja Filter: au.abn<a class="headerlink" href="#jinja-filter-auabn" title="Permanent link">&para;</a></h4>
<p>Format an Australian Business Number (ABN).</p>
<p>This supersedes the, now deprecated, <code>abn</code> filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><span class="n">au</span><span class="o">.</span><span class="n">abn</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-4-1"><span class="cp">{{</span> <span class="s1">&#39;51824753556&#39;</span>  <span class="o">|</span> <span class="nf">au</span><span class="nv">.abn</span> <span class="cp">}}</span><span class="x"> --&gt; 51 824 753 556 </span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-auacn">Jinja Filter: au.acn<a class="headerlink" href="#jinja-filter-auacn" title="Permanent link">&para;</a></h4>
<p>Format an Australian Company Number (ACN). This supersedes the, now deprecated,
<code>acn</code> filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><span class="n">au</span><span class="o">.</span><span class="n">acn</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-6-1"><span class="cp">{{</span> <span class="s1">&#39;123456789&#39;</span> <span class="o">|</span> <span class="nf">au</span><span class="nv">.acn</span> <span class="cp">}}</span><span class="x"> --&gt; 123 456 789</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-compact_decimal">Jinja Filter: compact_decimal<a class="headerlink" href="#jinja-filter-compact_decimal" title="Permanent link">&para;</a></h4>
<p>Format numeric values.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_compact_decimal">format_compact_decimal()</a>
API. All of its parameters can be used in the filter to obtain fine-grained
control over formatting.</p>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>. It can also be specified explicitly by
adding a <code>locale</code> argument to the filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><span class="n">compact_decimal</span><span class="p">(</span>
</span><span id="__span-7-2">    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-7-3">    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="__span-7-4">    <span class="n">rounding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;half-up&#39;</span><span class="p">,</span>
</span><span id="__span-7-5">    <span class="n">default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-7-6">    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-7-7"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. Numbers and strings containing numbers are accepted.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_compact_decimal">format_compact_decimal()</a>.</td>
</tr>
<tr>
<td>rounding</td>
<td>How to round the value. This must be one of the rounding modes in Babel's <code>decimal.ROUND_*</code>, with the <code>ROUND_</code> prefix removed. Case is ignored and hyphens become underscores. Defaults to <code>half-up</code> (Excel style rounding), instead of <code>half-even</code> (Bankers rounding) which is Python's normal default.</td>
</tr>
<tr>
<td>default</td>
<td>The default value to use for the filter if the input value is empty (i.e. None or an empty string). If the input value is empty and <code>default</code> is a string, it is used as-is as the return value of the filter. If the input value is empty, and <code>default</code> is not specified, an error is raised. Otherwise, the default is assumed to be numeric and is used as the input to the filter. <strong>Note:</strong> The <code>default</code> parameter does something different to the Jinja standard <a href="https://jinja.palletsprojects.com/en/stable/templates/#jinja-filters.default">default</a> filter. They are both useful but not interchangeable.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_compact_decimal">format_compact_decimal()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-8-1"><span class="cp">{{</span> <span class="m">1234.5678</span> <span class="o">|</span> <span class="nf">compact_decimal</span> <span class="cp">}}</span><span class="x"> --&gt; 1K</span>
</span><span id="__span-8-2"><span class="cp">{{</span> <span class="s1">&#39;1234.5678&#39;</span> <span class="o">|</span> <span class="nf">compact_decimal</span> <span class="cp">}}</span><span class="x"> --&gt; 1K</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-9-1"><span class="cp">{{</span> <span class="m">1234.5678</span> <span class="o">|</span> <span class="nf">compact</span> <span class="nv">decimal</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 1 k</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-css_id">Jinja Filter: css_id<a class="headerlink" href="#jinja-filter-css_id" title="Permanent link">&para;</a></h4>
<p>Sanitise a string to be a valid CSS identifier.</p>
<p>!!! "Filter Signature"</p>
<div class="language-text highlight"><pre><span></span><code>```python
css_id(value: str) -&gt; str
```
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-11-1"><span class="cp">{{</span> <span class="s1">&#39;a/()=*&amp;bcd&#39;</span><span class="err">&#39;</span> <span class="o">|</span> <span class="nf">css_id</span> <span class="cp">}}</span><span class="x"> --&gt; abcd</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-currency">Jinja Filter: currency<a class="headerlink" href="#jinja-filter-currency" title="Permanent link">&para;</a></h4>
<p>Format a currency value.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_currency">format_currency()</a>
API.</p>
<p>It is important to understand that there are two orthogonal aspects to formatting
currency values:</p>
<ol>
<li>
<p>The currency involved, such as Australian dollars (AUD), Euros (EUR) etc.</p>
</li>
<li>
<p>The locale in which the currency is to be presented.</p>
</li>
</ol>
<p>For example:</p>
<ul>
<li>One Australian dollar would appear in Australia as <code>$1.00</code>.</li>
<li>One Australian dollar would appear in the US as <code>A$1.00</code></li>
<li>One Australian dollar would appear in France as <code>1,00 AU$</code></li>
</ul>
<p>For the <strong>docma</strong> filter, the currency (AUD in the example above) can be
specified in one of two ways:</p>
<ol>
<li>By providing an argument to the currency filter <code>{{ 1 | currency('AUD') }}</code>;
    or</li>
<li>Using the currency name itself as an alias for the filter name
    <code>{{ 1 | AUD }}</code>. Docma dynamically generates a filter alias for known
    currencies. Case is not significant.</li>
</ol>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>.  It can also be specified explicitly by
adding a <code>locale</code> argument to the filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><span class="n">currency</span><span class="p">(</span>
</span><span id="__span-12-2">    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-12-3">    <span class="n">currency</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-12-4">    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="__span-12-5">    <span class="n">rounding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;half-up&#39;</span><span class="p">,</span>
</span><span id="__span-12-6">    <span class="n">default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-12-7">    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-12-8"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
<p>... or .... </p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><span class="o">&lt;</span><span class="n">CURRENCY_CODE</span><span class="o">&gt;</span><span class="p">(</span>
</span><span id="__span-13-2">    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-13-3">    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="__span-13-4">    <span class="n">rounding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;half-up&#39;</span><span class="p">,</span>
</span><span id="__span-13-5">    <span class="n">default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-13-6">    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-13-7"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
<p>Here <code>&lt;CURRENCY_CODE&gt;</code> can be <code>AUD</code>, <code>GBP</code>, <code>EUR</code> etc.</p>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. Numbers and strings containing numbers are accepted. Jinja will inject this automatically.</td>
</tr>
<tr>
<td>currency</td>
<td>The currency code (e.g <code>AUD</code>, <code>EUR</code> etc.)</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_currency">format_currency()</a>.</td>
</tr>
<tr>
<td>rounding</td>
<td>How to round the value. This must be one of the rounding modes in Babel's <code>decimal.ROUND_*</code>, with the <code>ROUND_</code> prefix removed. Case is ignored and hyphens become underscores. Defaults to <code>half-up</code> (Excel style rounding), instead of <code>half-even</code> (Bankers rounding) which is Python's normal default.</td>
</tr>
<tr>
<td>default</td>
<td>The default value to use for the filter if the input value is empty (i.e. None or an empty string but not zero). If the input value is empty and <code>default</code> is a string, it is used as-is as the return value of the filter. If the input value is empty, and <code>default</code> is not specified, an error is raised. Otherwise, the default is assumed to be numeric and is used as the input to the filter. <strong>Note:</strong> The <code>default</code> parameter does something different to the Jinja standard <a href="https://jinja.palletsprojects.com/en/stable/templates/#jinja-filters.default">default</a> filter. They are both useful but not interchangeable.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_decimal">format_decimal()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-14-1"><span class="cp">{{</span> <span class="m">123</span> <span class="o">|</span> <span class="nf">AUD</span> <span class="cp">}}</span><span class="x"> --&gt; $123.00</span>
</span><span id="__span-14-2"><span class="cp">{{</span> <span class="m">123</span> <span class="o">|</span> <span class="nf">currency</span><span class="o">(</span><span class="s1">&#39;AUD&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; $123.00</span>
</span><span id="__span-14-3"><span class="cp">{{</span> <span class="s1">&#39;123&#39;</span> <span class="o">|</span> <span class="nf">NZD</span> <span class="cp">}}</span><span class="x"> --&gt; NZD123.00 (numeric strings are fine as input)</span>
</span><span id="__span-14-4"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">AUD</span> <span class="cp">}}</span><span class="x"> --&gt; ERROR!</span>
</span><span id="__span-14-5"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">AUD</span><span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="m">0</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; $0.00</span>
</span><span id="__span-14-6"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">AUD</span><span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="s1">&#39;FREE!&#39;</span><span class="o">)</span><span class="cp">}}</span><span class="x"> --&gt; FREE!</span>
</span><span id="__span-14-7"><span class="cp">{{</span> <span class="o">-</span><span class="m">123</span> <span class="o">|</span> <span class="nf">AUD</span><span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s2">&quot;¤#,###;(¤#)&quot;</span><span class="o">,</span> <span class="nv">currency_digits</span><span class="o">=</span><span class="kp">False</span><span class="o">)</span><span class="cp">}}</span><span class="x"> --&gt; ($123)</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-15-1"><span class="cp">{{</span> <span class="m">123</span> <span class="o">|</span> <span class="nf">EUR</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;en_GB&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; €123.00</span>
</span><span id="__span-15-2"><span class="cp">{{</span> <span class="m">123</span> <span class="o">|</span> <span class="nf">EUR</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span> <span class="cp">}}</span><span class="x"> --&gt; 123,00 €</span>
</span></code></pre></div>
<p>The legacy <a href="#jinja-filter-dollars">dollars</a> filter can be replicated like so
(use whatever dollar currency is appropriate):</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-16-1"><span class="cp">{{</span> <span class="m">1234.5</span> <span class="o">|</span> <span class="nf">dollars</span> <span class="cp">}}</span><span class="x"> --&gt; </span><span class="cp">{{</span> <span class="m">1234.5</span> <span class="o">|</span> <span class="nf">AUD</span> <span class="cp">}}</span><span class="x"> --&gt; $1,234.50</span>
</span><span id="__span-16-2"><span class="cp">{{</span> <span class="m">1234.5</span> <span class="o">|</span> <span class="nf">dollars</span><span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; </span><span class="cp">{{</span> <span class="nv">AUD</span><span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s2">&quot;¤#,###&quot;</span><span class="o">,</span> <span class="nv">currency_digits</span><span class="o">=</span><span class="kp">False</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; $1,235</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-date">Jinja Filter: date<a class="headerlink" href="#jinja-filter-date" title="Permanent link">&para;</a></h4>
<p>Format date values.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_date">format_date()</a>
API. All of its parameters can be used in the filter to obtain fine-grained
control over formatting.</p>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>. It can also be specified explicitly by
adding a <code>locale</code> argument to the filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><span class="n">date</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. This must be a <code>datetime.date</code> or <code>datetime.datetime</code> instance.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_date">format_date()</a>.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_date">format_date()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-18-1"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">value</span> <span class="o">=</span> <span class="nv">docma.datetime.date</span><span class="o">(</span><span class="m">2025</span><span class="o">,</span> <span class="m">9</span><span class="o">,</span> <span class="m">17</span><span class="o">)</span> <span class="cp">%}</span>
</span><span id="__span-18-2">
</span><span id="__span-18-3"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">date</span> <span class="cp">}}</span><span class="x"> --&gt; 17 Sept 2025 (medium format is the default)</span>
</span><span id="__span-18-4"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">date</span><span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s1">&#39;short&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 17/9/25</span>
</span><span id="__span-18-5"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">date</span><span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s1">&#39;long&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 17 September 2025</span>
</span><span id="__span-18-6"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">date</span><span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; Wednesday, 17 September 2025</span>
</span><span id="__span-18-7"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">date</span><span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s1">&#39;dd/MM/yyyy&#39;</span><span class="o">)</span><span class="cp">}}</span><span class="x"> --&gt; 17/09/2025</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-19-1"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">datetime</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; Sep 17, 2025</span>
</span></code></pre></div>
</div>
<p>If date strings need to be handled, they will need to be converted to a Python
<a href="https://docs.python.org/3/library/datetime.html#datetime.date">datetime.date</a>
instance first. For date strings guaranteed to be in ISO 8601 format, Python's
standard <code>datetime.date.fromisoformat()</code> is fine. Otherwise, the safest way to
do this for dates containing only numbers (no month names) is to use the
<a href="#jinja-filter-parse_date">parse_date</a> filter as this is <strong>docma</strong> locale aware,
unlike the Python standard datetime.datetime.strptime().</p>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-20-1"><span class="cp">{{</span> <span class="nv">docma.datetime.date.fromisoformat</span><span class="o">(</span><span class="s1">&#39;2025-09-1&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">date</span> <span class="cp">}}</span><span class="x"> --&gt; 1 Sept 2025</span>
</span><span id="__span-20-2"><span class="cp">{{</span> <span class="s1">&#39;1/9/2025&#39;</span> <span class="o">|</span> <span class="nf">parse_date</span> <span class="o">|</span> <span class="nf">date</span> <span class="cp">}}</span><span class="x"> --&gt; 1 Sept 2025</span>
</span><span id="__span-20-3"><span class="cp">{{</span> <span class="s1">&#39;1/9/2025&#39;</span> <span class="o">|</span> <span class="nf">parse_date</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">date</span> <span class="cp">}}</span><span class="x"> --&gt; 9 Jan 2025</span>
</span></code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">You are in a maze of twisty little passages, all alike ...</p>
<p>There is no fully reliable way to parse arbitrary dates containing month
names in a generic, locale-aware away. Don't be tempted to attempt this in a
<strong>docma</strong> template. If you think you need to, you are either solving the
problem the wrong way or solving the wrong problem.</p>
</div>
<h4 id="jinja-filter-datetime">Jinja Filter: datetime<a class="headerlink" href="#jinja-filter-datetime" title="Permanent link">&para;</a></h4>
<p>Format datetime values.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_datetime">format_datetime()</a>
API. All of its parameters can be used in the filter to obtain fine-grained
control over formatting.</p>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>.  It can also be specified explicitly by
adding a <code>locale</code> argument to the filter.</p>
<p>The filter signature is:</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><span class="n">datetime</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. Typically, this would be a <code>datetime.datetime</code> instance. While <code>datetime.date</code> and <code>datetime.time</code> instances are also accepted, they are unlikely to be particularly useful.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_datetime">format_datetime()</a>.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_datetime">format_datetime()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-22-1"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">value</span> <span class="o">=</span> <span class="nv">docma.datetime.datetime</span><span class="o">(</span><span class="m">2025</span><span class="o">,</span> <span class="m">9</span><span class="o">,</span> <span class="m">17</span><span class="o">,</span> <span class="m">14</span><span class="o">,</span> <span class="m">15</span><span class="o">,</span> <span class="m">16</span><span class="o">)</span> <span class="cp">%}</span>
</span><span id="__span-22-2">
</span><span id="__span-22-3"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">datetime</span> <span class="cp">}}</span><span class="x"> --&gt; 17 Sept 2025, 2:15:16 pm</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-23-1"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">datetime</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; Sep 17, 2025, 2:15:16 PM</span>
</span></code></pre></div>
</div>
<p>If datetime strings need to be handled, they will need to be converted to a
Python
<a href="https://docs.python.org/3/library/datetime.html#datetime.datetime">datetime.datetime</a>
instance first. For datetime strings guaranteed to be in ISO 8601 format,
Python's standard <code>datetime.datetime.fromisoformat()</code> is fine.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-24-1"><span class="cp">{{</span> <span class="nv">docma.datetime.datetime.fromisoformat</span><span class="o">(</span><span class="s1">&#39;2025-09-17T14:15:16&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">datetime</span> <span class="cp">}}</span>
</span></code></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Avoid using the Python standard <code>datetime.datetime strptime()</code> if at all
possible. This will use the platform locale and cannot handle the <strong>docma</strong>
locale. The results can be very unpredictable.</p>
</div>
<h4 id="jinja-filter-decimal">Jinja Filter: decimal<a class="headerlink" href="#jinja-filter-decimal" title="Permanent link">&para;</a></h4>
<p>Format numeric values.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_decimal">format_decimal()</a>
API. All of its parameters can be used in the filter to obtain fine-grained
control over formatting.</p>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>.  It can also be explicitly specified by
adding a <code>locale</code> argument to the filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><span class="n">decimal</span><span class="p">(</span>
</span><span id="__span-25-2">    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-25-3">    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="__span-25-4">    <span class="n">rounding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;half-up&#39;</span><span class="p">,</span>
</span><span id="__span-25-5">    <span class="n">default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-25-6">    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-25-7"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. Numbers and strings containing numbers are accepted.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_decimal">format_decimal()</a>.</td>
</tr>
<tr>
<td>rounding</td>
<td>How to round the value. This must be one of the rounding modes in Babel's <code>decimal.ROUND_*</code>, with the <code>ROUND_</code> prefix removed. Case is ignored and hyphens become underscores. Defaults to <code>half-up</code> (Excel style rounding), instead of <code>half-even</code> (Bankers rounding) which is Python's normal default.</td>
</tr>
<tr>
<td>default</td>
<td>The default value to use for the filter if the input value is empty (i.e. None or an empty string, but not zero). If the input value is empty and <code>default</code> is a string, it is used as-is as the return value of the filter. If the input value is empty, and <code>default</code> is not specified, an error is raised. Otherwise, the default is assumed to be numeric and is used as the input to the filter. <strong>Note:</strong> The <code>default</code> parameter does something different to the Jinja standard <a href="https://jinja.palletsprojects.com/en/stable/templates/#jinja-filters.default">default</a> filter. They are both useful but not interchangeable.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_decimal">format_decimal()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-26-1"><span class="cp">{{</span> <span class="m">1234.5678</span> <span class="o">|</span> <span class="nf">decimal</span> <span class="cp">}}</span><span class="x"> --&gt; 1,234.568 (Default is to round to 3 decimal places)</span>
</span><span id="__span-26-2"><span class="cp">{{</span> <span class="s1">&#39;1234.5678&#39;</span> <span class="o">|</span> <span class="nf">decimal</span> <span class="cp">}}</span><span class="x"> --&gt; 1,234.568 (numeric strings are fine as input)</span>
</span><span id="__span-26-3"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">decimal</span> <span class="cp">}}</span><span class="x"> --&gt; ERROR!</span>
</span><span id="__span-26-4"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">decimal</span><span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="m">0</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 0</span>
</span><span id="__span-26-5"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">decimal</span><span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="s1">&#39;nix&#39;</span><span class="o">)</span><span class="cp">}}</span><span class="x"> --&gt; nix</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-27-1"><span class="cp">{{</span> <span class="m">1234.5678</span> <span class="o">|</span> <span class="nf">decimal</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 1 234,568</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-dollars">Jinja Filter: dollars<a class="headerlink" href="#jinja-filter-dollars" title="Permanent link">&para;</a></h4>
<p>Round and format a currency value as dollars.</p>
<p>Banker's half-up, rounding is used (like Excel) instead of the half-even
rounding that is Python's normal default.</p>
<p>This filter is a legacy that is not actually deprecated (yet), but its use is
discouraged. Use the <a href="#jinja-filter-currency">currency</a> filter in preference.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><span class="n">dollars</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span> <span class="n">precision</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>A number or numeric string.</td>
</tr>
<tr>
<td>precision</td>
<td>Number of decimal places to show. Defaults to 2.</td>
</tr>
<tr>
<td>symbol</td>
<td>The currency symbol to show. Defaults to <code>$</code>.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-29-1"><span class="cp">{{</span> <span class="m">1234.50</span> <span class="o">|</span> <span class="nf">dollars</span> <span class="cp">}}</span><span class="x"> --&gt; $1,234.50</span>
</span><span id="__span-29-2"><span class="cp">{{</span> <span class="m">1234.50</span> <span class="o">|</span> <span class="nf">dollars</span><span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; $1,235</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-parse_date">Jinja Filter: parse_date<a class="headerlink" href="#jinja-filter-parse_date" title="Permanent link">&para;</a></h4>
<p>Parse a date string into a <a href="https://docs.python.org/3/library/datetime.html#datetime.date">datetime.date</a> instance.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.parse_date">parse_date()</a>
API.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><span class="n">parse_date</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. The parser understands component ordering variations by locale but cannot handle month names. Numbers only.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.parse_date">parse_date()</a>.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.parse_date">parse_date()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-31-1"><span class="cp">{{</span> <span class="s1">&#39;1/9/2025&#39;</span> <span class="o">|</span> <span class="nf">parse_date</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; datetime.date(2025, 9, 1)</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-32-1"><span class="cp">{{</span> <span class="s1">&#39;1/9/2025&#39;</span> <span class="o">|</span> <span class="nf">parse_date</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; datetime.date(2025, 1, 9)</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-parse_time">Jinja Filter: parse_time<a class="headerlink" href="#jinja-filter-parse_time" title="Permanent link">&para;</a></h4>
<p>Parse a date string into a <a href="https://docs.python.org/3/library/datetime.html#datetime.time">datetime.time</a> instance.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.parse_time">parse_time()</a>
API.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><span class="n">parse_time</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.parse_time">parse_time()</a>.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.parse_time">parse_time()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-34-1"><span class="cp">{{</span> <span class="s1">&#39;2:15 pm&#39;</span> <span class="o">|</span> <span class="nf">parse_time</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; datetime.time(14, 15)</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-35-1"><span class="cp">{{</span> <span class="s1">&#39;1/9/2025&#39;</span> <span class="o">|</span> <span class="nf">parse_date</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; datetime.date(2025, 1, 9)</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-percent">Jinja Filter: percent<a class="headerlink" href="#jinja-filter-percent" title="Permanent link">&para;</a></h4>
<p>Format percentage values.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_percent">format_percent()</a>
API. All of its parameters can be used in the filter to obtain fine-grained
control over formatting.</p>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>.  It can also be specified explicitly by
adding a <code>locale</code> argument to the filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-36-1"><span class="n">percent</span><span class="p">(</span>
</span><span id="__span-36-2">    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="__span-36-3">    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="__span-36-4">    <span class="n">rounding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;half-up&#39;</span><span class="p">,</span>
</span><span id="__span-36-5">    <span class="n">default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-36-6">    <span class="o">**</span><span class="n">kwargs</span>
</span><span id="__span-36-7"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. Numbers and strings containing numbers are accepted.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_percent">format_percent()</a>.</td>
</tr>
<tr>
<td>rounding</td>
<td>How to round the value. This must be one of the rounding modes in Babel's <code>decimal.ROUND_*</code>, with the <code>ROUND_</code> prefix removed. Case is ignored and hyphens become underscores. Defaults to <code>half-up</code> (Excel style rounding), instead of <code>half-even</code> (Bankers rounding) which is Python's normal default.</td>
</tr>
<tr>
<td>default</td>
<td>The default value to use for the filter if the input value is empty (i.e. None or an empty string). If the input value is empty and <code>default</code> is a string, it is used as-is as the return value of the filter. If the input value is empty, and <code>default</code> is not specified, an error is raised. Otherwise, the default is assumed to be numeric and is used as the input to the filter. <strong>Note:</strong> The <code>default</code> parameter does something different to the Jinja standard <a href="https://jinja.palletsprojects.com/en/stable/templates/#jinja-filters.default">default</a> filter. They are both useful but not interchangeable.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/numbers.html#babel.numbers.format_percent">format_percent()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-37-1"><span class="cp">{{</span> <span class="m">0.1234</span> <span class="o">|</span> <span class="nf">percent</span> <span class="cp">}}</span><span class="x"> --&gt; 12%</span>
</span><span id="__span-37-2"><span class="cp">{{</span> <span class="s1">&#39;0.1234&#39;</span> <span class="o">|</span> <span class="nf">percent</span> <span class="cp">}}</span><span class="x"> --&gt; 12%</span>
</span><span id="__span-37-3"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">percent</span> <span class="cp">}}</span><span class="x"> --&gt; ERROR!</span>
</span><span id="__span-37-4"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">percent</span><span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="m">0</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 0%</span>
</span><span id="__span-37-5"><span class="cp">{{</span> <span class="kp">None</span> <span class="o">|</span> <span class="nf">percent</span><span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="o">)</span><span class="cp">}}</span><span class="x"> --&gt; --</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-38-1"><span class="cp">{{</span> <span class="s1">&#39;0.123&#39;</span> <span class="o">|</span> <span class="nf">percent</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 12 %</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-phone">Jinja Filter: phone<a class="headerlink" href="#jinja-filter-phone" title="Permanent link">&para;</a></h4>
<p>Format phone numbers. If a number cannot be formatted, the unmodified input is
returned.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter.</p>
<p>The underlying process is implemented using the excellent Python
<a href="https://github.com/daviddrysdale/python-phonenumbers">phonenumbers</a> package,
which is itself a port of
<a href="https://github.com/google/libphonenumber">Google's libphonenumber library</a>.</p>
<p>Phone number formatting varies substantially internationally. Hence, the filter
needs to determine the relevant region for each phone number. It can do that in
one of 3 ways (highest precedence to lowest)</p>
<ol>
<li>
<p>An international code in the source phone number.</p>
</li>
<li>
<p>An explicit region code argument to the phone filter (expressed as a
    two-character ISO country code).</p>
</li>
<li>
<p>By assuming the phone number is associated with the effective locale setting
    For example, a locale setting of <code>en_AU</code> would imply the number is part of the
    Australian phone numbering plan.</p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-39-1"><span class="n">phone</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>number</td>
<td>The phone number input to the filter. Phone numbers are always strings, never integers. Ever.</td>
</tr>
<tr>
<td>region</td>
<td>The region to which the phone number belongs as a 2 character ISO country code. Ignored if the phone number includes an international code. If not specified, the country code from the current effective locale is used.</td>
</tr>
<tr>
<td>format</td>
<td>See below.</td>
</tr>
</tbody>
</table>
<p>Phone numbers can be formatted in different ways. The following values of the <code>format</code> parameter are supported:</p>
<table>
<thead>
<tr>
<th>Format</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>E164</td>
<td>E.164 is the standard International Telecommunication Union (ITU) format for worldwide telephone numbers. e.g. <code>+61491570006</code></td>
</tr>
<tr>
<td>INTERNATIONAL</td>
<td>The full international phone number, formatted as per national conventions. e.g. <code>+61 491 570 006</code></td>
</tr>
<tr>
<td>NATIONAL</td>
<td>The national number component of the phone number without the international code component, formatted as per national conventions. e.g. <code>0491 570 006</code></td>
</tr>
<tr>
<td>RFC3966</td>
<td>The URI format for phone numbers. This will typically generate one-touch call links in on-line content. e.g. <code>tel:+61-491-570-006</code></td>
</tr>
</tbody>
</table>
<p>If not specified, <code>NATIONAL</code> is used if the region for the phone number matches
that for the current locale and <code>INTERNATIONAL</code> otherwise.</p>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-40-1"><span class="cp">{{</span> <span class="s1">&#39;0491 570 006&#39;</span> <span class="o">|</span> <span class="nf">phone</span> <span class="cp">}}</span><span class="x"> --&gt; 0491 570 006 (Locale will provide &quot;AU&quot; as region)</span>
</span><span id="__span-40-2"><span class="cp">{{</span> <span class="s1">&#39;+61 491 570 006&#39;</span> <span class="o">|</span> <span class="nf">phone</span> <span class="cp">}}</span><span class="x"> --&gt; 0491 570 006 (Region comes from the number)</span>
</span><span id="__span-40-3"><span class="cp">{{</span> <span class="s1">&#39;4155550132&#39;</span> <span class="o">|</span> <span class="nf">phone</span><span class="o">(</span><span class="s1">&#39;US&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; +1 415-555-0132</span>
</span><span id="__span-40-4"><span class="cp">{{</span> <span class="s1">&#39;4155550132&#39;</span><span class="o">|</span> <span class="nf">phone</span><span class="o">(</span><span class="s1">&#39;US&#39;</span><span class="o">,</span> <span class="nv">format</span><span class="o">=</span><span class="s1">&#39;NATIONAL&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; (415) 555-0132</span>
</span><span id="__span-40-5"><span class="cp">{{</span> <span class="s1">&#39;4155550132&#39;</span><span class="o">|</span> <span class="nf">phone</span><span class="o">(</span><span class="s1">&#39;US&#39;</span><span class="o">,</span> <span class="nv">format</span><span class="o">=</span><span class="s1">&#39;RFC3966&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; tel:+1-415-555-0132</span>
</span><span id="__span-40-6"><span class="cp">{{</span> <span class="s1">&#39;bad-to-the-phone&#39;</span> <span class="cp">}}</span><span class="x"> --&gt; bad-to-the-phone (If all else fails, return the input)</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-require">Jinja Filter: require<a class="headerlink" href="#jinja-filter-require" title="Permanent link">&para;</a></h4>
<p>Abort with an error message if the value is not a truthy value (i.e. a non-empty
string, non-zero integer etc), otherwise return the value.</p>
<p>This is useful for situations where it is better to abort if an expression is
expected to have a value, but doesn't, rather than make assumptions.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-41-1"><span class="n">require</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</span></code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-42-1"><span class="x">Dear Bob,</span>
</span><span id="__span-42-2">
</span><span id="__span-42-3"><span class="x">Your flight details have changed and your flight will now depart at</span>
</span><span id="__span-42-4"><span class="cp">{{</span> <span class="nv">flight_time</span> <span class="o">|</span> <span class="nf">require</span><span class="o">(</span><span class="s1">&#39;flight_time must be a non-empty string&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">.</span>
</span><span id="__span-42-5">
</span><span id="__span-42-6"><span class="x">Don&#39;t be late.</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-sql_safe">Jinja Filter: sql_safe<a class="headerlink" href="#jinja-filter-sql_safe" title="Permanent link">&para;</a></h4>
<p>Ensure that a string value is safe to use in SQL and generate an error if not.</p>
<p>This is primarily for use in query specifications to avoid SQL injection. It has
a puritanical view on safety but will cover most normal requirements.</p>
<div class="admonition note">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-43-1"><span class="n">sql_safe</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-44-1"><span class="x">SELECT * from </span><span class="cp">{{</span> <span class="nv">table</span> <span class="o">|</span> <span class="nf">sql_safe</span> <span class="cp">}}</span><span class="x"> ...</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-time">Jinja Filter: time<a class="headerlink" href="#jinja-filter-time" title="Permanent link">&para;</a></h4>
<p>Format time values.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_time">format_time()</a>
API. All of its parameters can be used in the filter to obtain fine-grained
control over formatting.</p>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>.  It can also be specified explicitly by
adding a <code>locale</code> argument to the filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><span class="n">time</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. This must be a <code>datetime.time</code> or <code>datetime.datetime</code> instance.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_time">format_time()</a>.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_time">format_time()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-46-1"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">value</span> <span class="o">=</span> <span class="nv">docma.datetime.time</span><span class="o">(</span><span class="m">14</span><span class="o">,</span> <span class="m">15</span><span class="o">)</span> <span class="cp">%}</span>
</span><span id="__span-46-2">
</span><span id="__span-46-3"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">time</span> <span class="cp">}}</span><span class="x"> --&gt; 2:15:00 pm</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-47-1"><span class="cp">{{</span> <span class="nv">value</span> <span class="o">|</span> <span class="nf">datetime</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;de_DE&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 14:15:00</span>
</span></code></pre></div>
<p>If time strings need to be handled, they will need to be converted to a Python
<a href="https://docs.python.org/3/library/datetime.html#datetime.time">datetime.time</a>
instance first. The safest way to do this is to use the
<a href="#jinja-filter-parse_time">parse_time</a> filter as this is <strong>docma</strong> locale aware.</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-48-1"><span class="cp">{{</span> <span class="s1">&#39;14:15&#39;</span> <span class="o">|</span> <span class="nf">parse_time</span> <span class="o">|</span> <span class="nf">time</span> <span class="cp">}}</span><span class="x"> --&gt; 2:15:00 pm</span>
</span><span id="__span-48-2"><span class="cp">{{</span> <span class="s1">&#39;2:15 pm&#39;</span> <span class="o">|</span> <span class="nf">parse_time</span> <span class="o">|</span> <span class="nf">time</span> <span class="cp">}}</span><span class="x"> --&gt; 2:15:00 pm</span>
</span></code></pre></div>
</div>
<h4 id="jinja-filter-timedelta">Jinja Filter: timedelta<a class="headerlink" href="#jinja-filter-timedelta" title="Permanent link">&para;</a></h4>
<p>Format timedelta values.</p>
<p>This is a <a href="03-document-templates.html#locale-in-docma-templates">locale-aware</a> filter that provides an
interface to the Babel
<a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_timedelta">format_timedelta()</a>
API. All of its parameters can be used in the filter to obtain fine-grained control over formatting.</p>
<p>The locale is determined as described in <a href="03-document-templates.html#locale-in-docma-templates">Locale in Docma
Templates</a>.  It can also be specified explicitly by
adding a <code>locale</code> argument to the filter.</p>
<div class="admonition info">
<p class="admonition-title">Filter Signature</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><span class="n">timedelta</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span> <span class="o">|</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</span></code></pre></div>
</div>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>Filter input value. This must be a <code>datetime.timedelta</code> instance.</td>
</tr>
<tr>
<td>*args</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_timedelta">format_timedelta()</a>.</td>
</tr>
<tr>
<td>**kwargs</td>
<td>Passed to Babel's <a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_timedelta">format_timedelta()</a>. This includes the option of using the <code>locale</code> parameter to specify locale.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The Babel
<a href="https://babel.pocoo.org/en/latest/api/dates.html#babel.dates.format_timedelta">format_timedelta()</a> 
rounding process is not particularly intuitive on first appearance but makes
sense once you get the hang of it. You may need to experiment with
<code>threshold</code> and <code>granularity</code> arguments to get the desired effect.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Examples</p>
<p>Assuming locale is set to <code>en_AU</code>:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-50-1"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">d1</span> <span class="o">=</span> <span class="nv">docma.datetime.datetime</span><span class="o">(</span><span class="m">2025</span><span class="o">,</span> <span class="m">9</span><span class="o">,</span> <span class="m">17</span><span class="o">,</span> <span class="m">14</span><span class="o">,</span> <span class="m">15</span><span class="o">,</span> <span class="m">16</span><span class="o">)</span> <span class="cp">%}</span>
</span><span id="__span-50-2"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">d2</span> <span class="o">=</span> <span class="nv">docma.datetime.datetime</span><span class="o">(</span><span class="m">2025</span><span class="o">,</span> <span class="m">9</span><span class="o">,</span> <span class="m">19</span><span class="o">,</span> <span class="m">14</span><span class="o">,</span> <span class="m">15</span><span class="o">,</span> <span class="m">16</span><span class="o">)</span> <span class="cp">%}</span>
</span><span id="__span-50-3">
</span><span id="__span-50-4"><span class="cp">{{</span> <span class="o">(</span><span class="nv">d2</span> <span class="o">-</span> <span class="nv">d1</span><span class="o">)</span> <span class="o">|</span> <span class="nf">timedelta</span> <span class="cp">}}</span><span class="x"> --&gt; 2 days (default format is &#39;long&#39;)</span>
</span><span id="__span-50-5"><span class="cp">{{</span> <span class="o">(</span><span class="nv">d2</span> <span class="o">-</span> <span class="nv">d1</span><span class="o">)</span> <span class="o">|</span> <span class="nf">timedelta</span><span class="o">(</span><span class="nv">format</span><span class="o">=</span><span class="s1">&#39;narrow&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; 2d</span>
</span><span id="__span-50-6"><span class="cp">{{</span> <span class="o">(</span><span class="nv">d2</span> <span class="o">-</span> <span class="nv">d1</span><span class="o">)</span> <span class="o">|</span> <span class="nf">timedelta</span><span class="o">(</span><span class="nv">add_direction</span><span class="o">=</span><span class="kp">True</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; in 2 days</span>
</span></code></pre></div>
<p>Locale can be specified explicitly, if required:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-51-1"><span class="cp">{{</span> <span class="o">(</span><span class="nv">d2</span> <span class="o">-</span> <span class="nv">d1</span><span class="o">)</span> <span class="o">|</span> <span class="nf">timedelta</span><span class="o">(</span><span class="nv">locale</span><span class="o">=</span><span class="s1">&#39;uk_UA&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> --&gt; &#39;2 дні&#39;</span>
</span></code></pre></div>
</div>
<h2 id="docma-jinja-extensions">Docma Jinja Extensions<a class="headerlink" href="#docma-jinja-extensions" title="Permanent link">&para;</a></h2>
<p>Docma provides some custom Jinja extensions.
In Jinja, extensions are invoked using the following syntax:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-52-1"><span class="cp">{%</span> <span class="k">tag</span> <span class="o">[</span><span class="nv">parameters</span><span class="o">]</span> <span class="cp">%}</span>
</span></code></pre></div>
<p>In addition to the custom extensions described below, <strong>docma</strong> also provides
the following standard Jinja extensions:</p>
<ul>
<li><a href="https://jinja.palletsprojects.com/en/stable/extensions/#debug-extension">debug</a></li>
<li><a href="https://jinja.palletsprojects.com/en/stable/extensions/#loop-controls">loopcontrols</a>.</li>
</ul>
<h4 id="jinja-extension-abort">Jinja Extension: abort<a class="headerlink" href="#jinja-extension-abort" title="Permanent link">&para;</a></h4>
<p>The <strong>abort</strong> extension forces the rendering process to abort with an exception
message. It would typically be used in response to some failed correctness check
where it's preferable to fail document production rather than to proceed in
error.</p>
<p>For example:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-53-1"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">bad_data</span> <span class="cp">%}</span>
</span><span id="__span-53-2"><span class="x">    </span><span class="cp">{%</span> <span class="k">abort</span> <span class="s1">&#39;Fatal error - bad data&#39;</span> <span class="cp">%}</span>
</span><span id="__span-53-3"><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</span></code></pre></div>
<h4 id="jinja-extension-dump_params">Jinja Extension: dump_params<a class="headerlink" href="#jinja-extension-dump_params" title="Permanent link">&para;</a></h4>
<p>The <strong>dump_params</strong> extension simply dumps the rendering parameters for
debugging purposes. The standard Jinja
<a href="https://jinja.palletsprojects.com/en/stable/extensions/#debug-extension">debug</a>
extension does something similar (and a bit more) but much less readably.</p>
<p>Typical usage would be:</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-54-1"><span class="p">&lt;</span><span class="nt">PRE</span><span class="p">&gt;</span>{% dump_params %}<span class="p">&lt;/</span><span class="nt">PRE</span><span class="p">&gt;</span>
</span></code></pre></div>
<h4 id="jinja-extension-global">Jinja Extension: global<a class="headerlink" href="#jinja-extension-global" title="Permanent link">&para;</a></h4>
<p>The <strong>global</strong> extension allows values defined within the Jinja content of a
HTML document to be made available when rendering other components in a
document template.</p>
<p>For example, the following declares the <em>globals</em> <code>a</code> and <code>b</code>.</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-55-1"><span class="cp">{%</span> <span class="k">global</span> <span class="nv">a</span><span class="o">=</span><span class="m">1</span><span class="o">,</span> <span class="nv">b</span><span class="o">=</span><span class="s1">&#39;Plugh&#39;</span> <span class="cp">%}</span>
</span></code></pre></div>
<p>These can then be accessed, either in the file in which they were declared or in
a different HTML document, or a <a href="08-data-sources.html#query-specifications">query specification</a>
like so:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-56-1"><span class="x">You are at Y</span><span class="cp">{{</span> <span class="nv">globals.a</span> <span class="o">+</span> <span class="m">1</span> <span class="cp">}}</span><span class="x">. A hollow voice says &quot;</span><span class="cp">{{</span> <span class="nv">globals.b</span> <span class="cp">}}</span><span class="x">.&quot;</span>
</span></code></pre></div>
<p>The result will be:</p>
<div class="language-bare highlight"><pre><span></span><code><span id="__span-57-1"><span class="err">Your</span><span class="w"> </span><span class="err">are</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">Y2.</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">hollow</span><span class="w"> </span><span class="err">voice</span><span class="w"> </span><span class="err">says</span><span class="w"> </span><span class="err">&quot;Plugh&quot;.</span>
</span></code></pre></div>
<p>Compare this with the standard Jinja <code>set</code> operation:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-58-1"><span class="cp">{%</span> <span class="k">set</span> <span class="nv">a</span><span class="o">=</span><span class="m">1</span> <span class="cp">%}</span>
</span></code></pre></div>
<p>The variable <code>a</code> can only be accessed in the file in which it is defined, or a
file that includes that file. It cannot be accessed in a different HTML
document, or a <a href="08-data-sources.html#query-specifications">query specification</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is important to understand that within the <strong>docma</strong> rendering phase, the
Jinja rendering of the component HTML documents is <em>completed</em> before the
<a href="05-template-rendering.html#dynamic-content-generation">generation and injection of dynamic content</a>.
This means that only the <em>final</em> value of any global parameter is available
during the dynamic content generation phase.</p>
<p>It is not possible to use globals to pass a loop variable from the Jinja
rendering of the HTML into the dynamic content generation phase.</p>
</div>
<h2 id="docma-format-checkers">Docma Format Checkers<a class="headerlink" href="#docma-format-checkers" title="Permanent link">&para;</a></h2>
<p>Docma includes an extensible set of format checkers. These can be used in two ways:</p>
<ol>
<li>
<p>In <a href="#format-checkers-in-json-schema">JSON schema specifications</a>
    as <code>format</code> specifiers for <code>string</code> data elements; and</p>
</li>
<li>
<p>As <a href="#format-checkers-in-jinja">Jinja tests</a> in content that will be
    Jinja rendered.</p>
</li>
</ol>
<p>The docma provided format checkers are divided into:</p>
<ul>
<li><a href="#generic-format-checkers">Generic checkers</a></li>
<li><a href="#regional-format-checkers">Region / country specific checkers</a>.</li>
</ul>
<p>All docma provided format checker names are case insensitive.</p>
<p>It is easy to <a href="11-extending-docma.html#format-checkers">add new format checkers</a>, as required.</p>
<h3 id="generic-format-checkers">Generic Format Checkers<a class="headerlink" href="#generic-format-checkers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Test Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>date.dmy</td>
<td>Date formatted as day/month/year. The separators can be any of <code>/-_.</code> or missing (e.g. <code>31/12/2024</code>, <code>31.12.2024</code>, <code>31-12-2024</code>, <code>31_12_2024</code>, <code>31122024</code>).</td>
</tr>
<tr>
<td>date.mdy</td>
<td>Date formatted as month/day/year. The separators can be any of <code>/-_.</code> or missing  (e.g. <code>12/31/2024</code>, ...).</td>
</tr>
<tr>
<td>date.ymd</td>
<td>Date formatted as year/month/day. The separators can be any of <code>/-_.</code> or missing (e.g. <code>2024/12/31</code>, ...).</td>
</tr>
<tr>
<td>DD/MM/YYYY</td>
<td><em>JSON Schema use only</em>. Deprecated. Use <code>date.dmy</code> instead.</td>
</tr>
<tr>
<td>energy_unit</td>
<td>An energy unit (e.g. kWh, MVArh).</td>
</tr>
<tr>
<td>locale</td>
<td>A locale specifier (e.g. <code>en_AU</code>, <code>fr_FR</code>)</td>
</tr>
<tr>
<td>power_unit</td>
<td>A power unit (e.g. kW, MVA).</td>
</tr>
<tr>
<td>semantic_version</td>
<td>A version in the form <code>major.minor.patch</code> (e.g. <code>1.3.0</code>).</td>
</tr>
</tbody>
</table>
<h3 id="regional-format-checkers">Regional Format Checkers<a class="headerlink" href="#regional-format-checkers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Checker Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACN</td>
<td>Deprecated. Use <code>au.abn</code> instead.</td>
</tr>
<tr>
<td>ABN</td>
<td>Deprecated. Use <code>au.abn</code> instead.</td>
</tr>
<tr>
<td>au.ABN</td>
<td>Australian Business Number.</td>
</tr>
<tr>
<td>au.ACN</td>
<td>Australian Company Number.</td>
</tr>
<tr>
<td>au.MIRN</td>
<td>Australian energy industry Gas Meter Installation Registration Number.</td>
</tr>
<tr>
<td>au.NMI</td>
<td>Australian energy industry National Metering Identifier.</td>
</tr>
<tr>
<td>MIRN</td>
<td>Deprecated. Use <code>au.MIRN</code> instead.</td>
</tr>
<tr>
<td>NMI</td>
<td>Deprecated. Use au.NMI instead.</td>
</tr>
</tbody>
</table>
<h3 id="format-checkers-in-json-schema">Format Checkers in JSON Schema<a class="headerlink" href="#format-checkers-in-json-schema" title="Permanent link">&para;</a></h3>
<p>JSON Schema specifications are supported, and strongly recommended, in a number
of docma components, such as as the <a href="03-document-templates.html#template-configuration-file">template configuration
file</a>, and <a href="08-data-sources.html#query-specifications">query
specifications</a>. They provide run-time type checking of
important data elements and are an important safety mechanism.</p>
<p>Like the <a href="https://json-schema.org/draft/2020-12/draft-bhutton-json-schema-validation-00#rfc.section.7.3">JSON Schema built-in
string formats</a>,
docma provided format checkers can be used in a schema specification with the
<code>format</code> attribute of string objects, like so:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-59-1"><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
</span><span id="__span-59-2"><span class="nt">properies</span><span class="p">:</span>
</span><span id="__span-59-3"><span class="w">  </span><span class="nt">prop1</span><span class="p">:</span>
</span><span id="__span-59-4"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-59-5"><span class="w">    </span><span class="c1"># Use a built in format like &quot;email&quot; or one of docma&#39;s format checkers</span>
</span><span id="__span-59-6"><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"> </span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Examples are given in YAML rather than JSON for readability, and because they
are specified in YAML in docma.</p>
</div>
<p>For example, consider a document template for a contract that requires
parameters for customer email, contract start date, and customer Australian
Business Number (ABN) to be specified: The relevant portion of the <a href="03-document-templates.html#template-configuration-file">template
configuration file</a> might look like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-60-1"><span class="nt">parameters</span><span class="p">:</span>
</span><span id="__span-60-2"><span class="w">  </span><span class="nt">schema</span><span class="p">:</span>
</span><span id="__span-60-3"><span class="w">    </span><span class="c1"># Schema for the schema!</span>
</span><span id="__span-60-4"><span class="w">    </span><span class="nt">$schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://json-schema.org/draft/2020-12/schema</span>
</span><span id="__span-60-5"><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Parameters validation schema</span>
</span><span id="__span-60-6"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span>
</span><span id="__span-60-7"><span class="w">    </span><span class="nt">required</span><span class="p">:</span>
</span><span id="__span-60-8"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">locale</span>
</span><span id="__span-60-9"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_email</span>
</span><span id="__span-60-10"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">customer_abn</span>
</span><span id="__span-60-11"><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">contract_start_date</span>
</span><span id="__span-60-12"><span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
</span><span id="__span-60-13"><span class="w">      </span><span class="nt">locale</span><span class="p">:</span>
</span><span id="__span-60-14"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-60-15"><span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">locale</span><span class="w">  </span><span class="c1"># This is a docma provided format checker</span>
</span><span id="__span-60-16"><span class="w">      </span><span class="nt">customer_email</span><span class="p">:</span>
</span><span id="__span-60-17"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-60-18"><span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span><span class="w">  </span><span class="c1"># This is a standard JSON schema format checker</span>
</span><span id="__span-60-19"><span class="w">      </span><span class="nt">customer_abn</span><span class="p">:</span>
</span><span id="__span-60-20"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-60-21"><span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">au.ABN</span><span class="w">   </span><span class="c1"># This is a docma provided format checker.</span>
</span><span id="__span-60-22"><span class="w">      </span><span class="nt">contract_start_date</span><span class="p">:</span>
</span><span id="__span-60-23"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
</span><span id="__span-60-24"><span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">date.dmy</span><span class="w">  </span><span class="c1"># This is a docma provided format checker</span>
</span></code></pre></div>
<p>Docma will validate values provided at run-time against this schema.</p>
<h3 id="format-checkers-in-jinja">Format Checkers in Jinja<a class="headerlink" href="#format-checkers-in-jinja" title="Permanent link">&para;</a></h3>
<p>In addition to the <a href="https://jinja.palletsprojects.com/en/stable/templates/#list-of-builtin-tests">standard tests provided by
Jinja</a>,
the docma format checkers can also be used as Jinja tests, like so:</p>
<div class="language-jinja highlight"><pre><span></span><code><span id="__span-61-1"><span class="cp">{%</span> <span class="k">if</span> <span class="nv">contract_date</span> <span class="k">is</span> <span class="k">not</span> <span class="nf">date</span><span class="nv">.dmy</span> <span class="cp">%}</span>
</span><span id="__span-61-2"><span class="cp">{%</span> <span class="k">abort</span> <span class="s1">&#39;Bad date&#39;</span> <span class="cp">%}</span>
</span><span id="__span-61-3"><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</span></code></pre></div>
<p>When used as Jinja tests, none of the docma format checkers accept an arguments
additional to the value being checked. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Docma can also be extended with Jinja tests that can accept additional
arguments, but these would not also be used in JSON Schema specifications
and hence would not be considered to be format checkers.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; Origin Energy
    </div>
  
</div>
      <div class="md-footer-social">
        <div class="md-copyright">
          <div class="md-copyright__highlight">
            
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": ".", "features": ["navigation.instant", "content.code.copy"], "search": "assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>